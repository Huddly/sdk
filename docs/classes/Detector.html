<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>huddly-sdk</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">huddly-sdk</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>Detector</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/components/detector.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Detector class used to configure genius framing on the camera.</p>

            </p>

            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                        <code><a href="https://angular.io/api/core/EventEmitter" target="_blank" >EventEmitter</a></code>
            </p>

            <p class="comment">
                <h3>Implements</h3>
            </p>
            <p class="comment">
                            <code><a href="../interfaces/IDetector.html" target="_self" >IDetector</a></code>
            </p>

            <p class="comment">
                <h3>Example</h3>
            </p>
            <div class="io-description">
            </div>

            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#_defaultLabelWhiteList">_defaultLabelWhiteList</a>
                            </li>
                            <li>
                                <a href="#_detectionHandler">_detectionHandler</a>
                            </li>
                            <li>
                                <a href="#_detectorInitialized">_detectorInitialized</a>
                            </li>
                            <li>
                                <a href="#_deviceManager">_deviceManager</a>
                            </li>
                            <li>
                                <a href="#_frame">_frame</a>
                            </li>
                            <li>
                                <a href="#_framingHandler">_framingHandler</a>
                            </li>
                            <li>
                                <a href="#_logger">_logger</a>
                            </li>
                            <li>
                                <a href="#_options">_options</a>
                            </li>
                            <li>
                                <a href="#_previewStreamStarted">_previewStreamStarted</a>
                            </li>
                            <li>
                                <a href="#_subscriptionsSetup">_subscriptionsSetup</a>
                            </li>
                            <li>
                                <a href="#_usePeopleCount">_usePeopleCount</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#destroy">destroy</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateOpts">updateOpts</a>
                            </li>
                            <li>
                                <a href="#validateOptions">validateOptions</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(manager: <a href="../interfaces/IDeviceManager.html">IDeviceManager</a>, logger: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, options?: <a href="../interfaces/DetectorOpts.html">DetectorOpts</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="31" class="link-to-prism">src/components/detector.ts:31</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Creates an instance of Detector.</p>
</div>
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>manager</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/IDeviceManager.html" target="_self" >IDeviceManager</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <code><p>An instance of the IDeviceManager (for example
the Boxfish implementation of IDeviceManager) for communicating with the device.</p>
</code>
                                                        </td>
                                                </tr>
                                                <tr>
                                                        <td>logger</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <code><p>Logger class for logging messages produced from the detector.</p>
</code>
                                                        </td>
                                                </tr>
                                                <tr>
                                                        <td>options</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/DetectorOpts.html" target="_self" >DetectorOpts</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            Yes
                                                    </td>
                                                    
                                                        <td>
                                                                <code><p>options detector.</p>
</code>
                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_defaultLabelWhiteList"></a>
                        <span class="name">
                            <b>
                            _defaultLabelWhiteList</b>
                            <a href="#_defaultLabelWhiteList"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Array&lt;String&gt;</code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>[&#x27;head&#x27;, &#x27;person&#x27;]</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="27" class="link-to-prism">src/components/detector.ts:27</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_detectionHandler"></a>
                        <span class="name">
                            <b>
                            _detectionHandler</b>
                            <a href="#_detectionHandler"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/components/detector.ts:23</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_detectorInitialized"></a>
                        <span class="name">
                            <b>
                            _detectorInitialized</b>
                            <a href="#_detectorInitialized"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>false</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="29" class="link-to-prism">src/components/detector.ts:29</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_deviceManager"></a>
                        <span class="name">
                            <b>
                            _deviceManager</b>
                            <a href="#_deviceManager"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../interfaces/IDeviceManager.html" target="_self" >IDeviceManager</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/components/detector.ts:21</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_frame"></a>
                        <span class="name">
                            <b>
                            _frame</b>
                            <a href="#_frame"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">src/components/detector.ts:25</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_framingHandler"></a>
                        <span class="name">
                            <b>
                            _framingHandler</b>
                            <a href="#_framingHandler"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="24" class="link-to-prism">src/components/detector.ts:24</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_logger"></a>
                        <span class="name">
                            <b>
                            _logger</b>
                            <a href="#_logger"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="22" class="link-to-prism">src/components/detector.ts:22</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_options"></a>
                        <span class="name">
                            <b>
                            _options</b>
                            <a href="#_options"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../interfaces/DetectorOpts.html" target="_self" >DetectorOpts</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="26" class="link-to-prism">src/components/detector.ts:26</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_previewStreamStarted"></a>
                        <span class="name">
                            <b>
                            _previewStreamStarted</b>
                            <a href="#_previewStreamStarted"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>false</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="30" class="link-to-prism">src/components/detector.ts:30</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_subscriptionsSetup"></a>
                        <span class="name">
                            <b>
                            _subscriptionsSetup</b>
                            <a href="#_subscriptionsSetup"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>false</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="28" class="link-to-prism">src/components/detector.ts:28</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_usePeopleCount"></a>
                        <span class="name">
                            <b>
                            _usePeopleCount</b>
                            <a href="#_usePeopleCount"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>false</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="31" class="link-to-prism">src/components/detector.ts:31</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="destroy"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            destroy
                        </b>
                        <a href="#destroy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>destroy()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="139"
                            class="link-to-prism">src/components/detector.ts:139</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateOpts"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            updateOpts
                        </b>
                        <a href="#updateOpts"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateOpts(options: <a href="../interfaces/DetectorOpts.html">DetectorOpts</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="132"
                            class="link-to-prism">src/components/detector.ts:132</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>options</td>
                                    <td>
                                                <code><a href="../interfaces/DetectorOpts.html" target="_self" >DetectorOpts</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="validateOptions"></a>
                    <span class="name">
                        <b>
                            validateOptions
                        </b>
                        <a href="#validateOptions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>validateOptions(options: <a href="../interfaces/DetectorOpts.html">DetectorOpts</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="50"
                            class="link-to-prism">src/components/detector.ts:50</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>options</td>
                                    <td>
                                                <code><a href="../interfaces/DetectorOpts.html" target="_self" >DetectorOpts</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>





    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { EventEmitter } from &#x27;events&#x27;;
import IDetector from &#x27;./../interfaces/IDetector&#x27;;
import IDeviceManager from &#x27;./../interfaces/iDeviceManager&#x27;;
import DetectorOpts, { DetectionConvertion } from &#x27;./../interfaces/IDetectorOpts&#x27;;
import Api from &#x27;./api&#x27;;
import CameraEvents from &#x27;./../utilitis/events&#x27;;
import semver from &#x27;semver&#x27;;

const PREVIEW_IMAGE_SIZE &#x3D; { width: 640, height: 480 };
const LATEST_WITHOUT_PEOPLE_COUNT &#x3D; &#x27;1.3.14&#x27;;

/**
 * Detector class used to configure genius framing on the camera.
 *
 * @export
 * @class Detector
 * @extends {EventEmitter}
 * @implements {IDetector}
 */
export default class Detector extends EventEmitter implements IDetector {
  _deviceManager: IDeviceManager;
  _logger: any;
  _detectionHandler: any;
  _framingHandler: any;
  _frame: any;
  _options: DetectorOpts;
  _defaultLabelWhiteList: Array&lt;String&gt; &#x3D; [&#x27;head&#x27;, &#x27;person&#x27;];
  _subscriptionsSetup: boolean &#x3D; false;
  _detectorInitialized: boolean &#x3D; false;
  _previewStreamStarted: boolean &#x3D; false;
  _usePeopleCount: boolean &#x3D; false;

  /**
   * Creates an instance of Detector.
   * @param {IDeviceManager} manager An instance of the IDeviceManager (for example
   * the Boxfish implementation of IDeviceManager) for communicating with the device.
   * @param {*} logger Logger class for logging messages produced from the detector.
   * @param {DetectorOpts} options options detector.
   * @memberof Detector
   */
  constructor(manager: IDeviceManager, logger: any, options?: DetectorOpts) {
    super();
    this._deviceManager &#x3D; manager;
    this._logger &#x3D; logger;
    this._options &#x3D; {};
    this.validateOptions(options);
    this.setMaxListeners(50);
  }

  validateOptions(options: DetectorOpts) {
    const currentSetOpts &#x3D; this._options;
    this._options &#x3D; {
      ...currentSetOpts,
      ...options,
    };
    this._options.convertDetections &#x3D;
      (options &amp;&amp; options.convertDetections) || DetectionConvertion.RELATIVE;
    this._options.DOWS &#x3D; (options &amp;&amp; options.DOWS) || false;
  }

  /**
   * @ignore
   * Check &#x60;IDetector&#x60; interface for method documentation.
   * @memberof Detector
   */
  async init(): Promise&lt;any&gt; {
    if (this._detectorInitialized) {
      this._logger.warn(&#x27;Detector already initialized&#x27;, &#x27;IQ Detector&#x27;);
      return;
    }

    const cameraInfo &#x3D; await this._deviceManager.getInfo();
    try {
      this._usePeopleCount &#x3D; semver.gt(cameraInfo.version, LATEST_WITHOUT_PEOPLE_COUNT);
    } catch (err) {
      this._logger.warn(&#x27;Unable to test camera version with semver.&#x27;);
      this._usePeopleCount &#x3D; false;
    }

    this._logger.debug(&#x27;Initializing detector class&#x27;, &#x27;IQ Detector&#x27;);
    if (!this._detectionHandler) {
      this._detectionHandler &#x3D; detectionBuffer &#x3D;&gt; {
        const { predictions } &#x3D; Api.decode(detectionBuffer.payload, &#x27;messagepack&#x27;);
        const convertedDetections &#x3D; this.convertDetections(predictions, this._options);
        this.emit(CameraEvents.DETECTIONS, convertedDetections);
      };
    }

    if (!this._framingHandler) {
      this._framingHandler &#x3D; frameBuffer &#x3D;&gt; {
        const frame &#x3D; Api.decode(frameBuffer.payload, &#x27;messagepack&#x27;);
        this.emit(CameraEvents.FRAMING, frame);
        this._frame &#x3D; frame;
      };
    }

    if (!this._options.DOWS) {
      if (this._usePeopleCount) {
        this._logger.debug(&#x27;Sending people_count start command&#x27;, &#x27;IQ Detector&#x27;);
        await this._deviceManager.transport.write(
          &#x27;people_count/start&#x27;,
          Api.encode({ STREAMING_ONLY: false })
        );
      } else {
        this._logger.debug(&#x27;Sending detector start command&#x27;, &#x27;IQ Detector&#x27;);
        await await this._deviceManager.transport.write(&#x27;detector/start&#x27;);
      }
      await this.setupDetectorSubscriptions({
        detectionListener: true,
        framingListener: false,
      });
      this._previewStreamStarted &#x3D; true;
    } else {
      this._logger.debug(
        &#x27;Setting up detection event listeners. \n\n** NB ** Host application must stream main in order to get detection events&#x27;,
        &#x27;IQ Detector&#x27;
      );

      if (this._usePeopleCount) {
        await this._deviceManager.transport.write(
          &#x27;people_count/start&#x27;,
          Api.encode({ STREAMING_ONLY: true })
        );
      }

      await this.setupDetectorSubscriptions();
    }
    this._detectorInitialized &#x3D; true;
    this._logger.debug(&#x27;Detector class initialized and ready&#x27;, &#x27;IQ Detector&#x27;);
  }

  async updateOpts(options: DetectorOpts): Promise&lt;any&gt; {
    this.validateOptions(options);
    await this.teardownDetectorSubscriptions();
    this._detectorInitialized &#x3D; false;
    return this.init();
  }

  async destroy(): Promise&lt;void&gt; {
    if (!this._detectorInitialized) {
      this._logger.warn(&#x27;Detector already destroyed&#x27;, &#x27;IQ Detector&#x27;);
      return;
    }

    if (this._usePeopleCount) {
      await this._deviceManager.transport.write(&#x27;people_count/stop&#x27;);
    }

    if (!this._options.DOWS &amp;&amp; this._previewStreamStarted) {
      this._logger.debug(
        &#x27;IQ Detector teardown by stopping detection generation on previewstream, unsubscribing to events and unregistering listeners&#x27;,
        &#x27;IQ Detector&#x27;
      );
      // Send &#x60;[people_count/detector]/stop&#x60; only if &#x60;[people_count/detector]/start&#x60; was called previously
      if (!this._usePeopleCount) {
        await this._deviceManager.transport.write(&#x27;detector/stop&#x27;);
      }
      this._previewStreamStarted &#x3D; false;
      await this.teardownDetectorSubscriptions({
        detectionListener: true,
        framingListener: false,
      });
    } else {
      if (this._usePeopleCount) {
        this._logger.debug(
          &#x27;IQ Detector teardown by  unsubscribing to events and unregistering listeners&#x27;
        );
      }
      this._logger.debug(
        &#x60;IQ Detector teardown by ${
          this._usePeopleCount ? &#x27;stopping detection generation on previewstream,&#x27; : &#x27;&#x27;
        } unsubscribing to events and unregistering listeners&#x60;
      );
      await this.teardownDetectorSubscriptions();
    }
    this._detectorInitialized &#x3D; false;
  }

  /**
   * @ignore
   * Convenience function for setting up detection and framing
   * data listeners and subscribing to camera events that send
   * such data to the host.
   *
   * @param {*} [listenerConfigOpts&#x3D;{
   *       detectionListener: true,
   *       framingListener: true,
   *     }]
   * @memberof Detector
   */
  async setupDetectorSubscriptions(
    listenerConfigOpts: any &#x3D; {
      detectionListener: true,
      framingListener: true,
    }
  ) {
    try {
      // Detection listener setup
      if (!this._subscriptionsSetup &amp;&amp; listenerConfigOpts.detectionListener) {
        await this._deviceManager.transport.subscribe(&#x27;autozoom/predictions&#x27;);
        this._deviceManager.transport.on(&#x27;autozoom/predictions&#x27;, this._detectionHandler);
      }
      // Framing listener setup
      if (!this._subscriptionsSetup &amp;&amp; listenerConfigOpts.framingListener) {
        await this._deviceManager.transport.subscribe(&#x27;autozoom/framing&#x27;);
        this._deviceManager.transport.on(&#x27;autozoom/framing&#x27;, this._framingHandler);
      }
      this._subscriptionsSetup &#x3D; true;
    } catch (e) {
      await this._deviceManager.transport.unsubscribe(&#x27;autozoom/predictions&#x27;);
      await this._deviceManager.transport.unsubscribe(&#x27;autozoom/framing&#x27;);
      this._logger.error(&#x27;Something went wrong getting predictions!&#x27;, e, &#x27;IQ Detector&#x27;);
      this._subscriptionsSetup &#x3D; false;
    }
  }

  /**
   * @ignore
   * Convenience function for tearing down all the setup listeners
   * for detection and framing data and unsubscribes from getting
   * detection events from camera.
   *
   * @param {*} [listenerConfigOpts&#x3D;{
   *       detectionListener: true,
   *       framingListener: true,
   *     }]
   * @memberof Detector
   */
  async teardownDetectorSubscriptions(
    listenerConfigOpts: any &#x3D; {
      detectionListener: true,
      framingListener: true,
    }
  ) {
    // Detection listener teardown
    if (this._subscriptionsSetup &amp;&amp; listenerConfigOpts.detectionListener) {
      await this._deviceManager.transport.unsubscribe(&#x27;autozoom/predictions&#x27;);
      this._deviceManager.transport.removeListener(&#x27;autozoom/predictions&#x27;, this._detectionHandler);
    }

    // Framing listener teardown
    if (this._subscriptionsSetup &amp;&amp; listenerConfigOpts.framingListener) {
      await this._deviceManager.transport.unsubscribe(&#x27;autozoom/framing&#x27;);
      this._deviceManager.transport.removeListener(&#x27;autozoom/framing&#x27;, this._framingHandler);
    }
    this._subscriptionsSetup &#x3D; false;
  }

  /**
   * @ignore
   * Normalizes and filters detection objects so they are relative to image size
   *
   * @param {detections} Array of detections
   * @returns {detections} Converted detections
   * @memberof Detector
   */
  convertDetections(detections: Array&lt;any&gt;, opts?: DetectorOpts): Array&lt;any&gt; {
    let objectFilter &#x3D; this._defaultLabelWhiteList;
    if (opts &amp;&amp; opts.objectFilter) {
      objectFilter &#x3D; opts.objectFilter;
    }
    const filteredDetections &#x3D;
      objectFilter.length &#x3D;&#x3D;&#x3D; 0
        ? detections
        : detections.filter(({ label }) &#x3D;&gt; {
            return objectFilter.some(x &#x3D;&gt; x &#x3D;&#x3D;&#x3D; label);
          });

    if (opts &amp;&amp; opts.convertDetections &#x3D;&#x3D;&#x3D; DetectionConvertion.FRAMING &amp;&amp; this._frame) {
      const { bbox: framingBBox } &#x3D; this._frame;
      const relativeSize &#x3D; {
        height: PREVIEW_IMAGE_SIZE.height / framingBBox.height,
        width: PREVIEW_IMAGE_SIZE.width / framingBBox.width,
      };
      return filteredDetections.map(({ label, bbox }) &#x3D;&gt; {
        return {
          label: label,
          bbox: {
            x: (bbox.x - framingBBox.x) * relativeSize.width,
            y: (bbox.y - framingBBox.y) * relativeSize.height,
            width: bbox.width * relativeSize.width,
            height: bbox.height * relativeSize.height,
            frameWidth: framingBBox.width * relativeSize.width,
            frameHeight: framingBBox.height * relativeSize.height,
          },
        };
      });
    } else {
      return filteredDetections.map(({ label, bbox }) &#x3D;&gt; {
        return {
          label: label,
          bbox: {
            x: bbox.x / PREVIEW_IMAGE_SIZE.width,
            y: bbox.y / PREVIEW_IMAGE_SIZE.height,
            width: bbox.width / PREVIEW_IMAGE_SIZE.width,
            height: bbox.height / PREVIEW_IMAGE_SIZE.height,
          },
        };
      });
    }
  }
}
</code></pre>
    </div>
</div>



                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'Detector.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
