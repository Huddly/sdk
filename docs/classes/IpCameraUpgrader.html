<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>huddly-sdk</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">huddly-sdk</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">












<ol class="breadcrumb">
  <li class="breadcrumb-item">Classes</li>
  <li class="breadcrumb-item" >IpCameraUpgrader</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/components/upgrader/ipUpgrader.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Controller class for instrumenting the upgrade process on Huddly IP cameras.</p>

            </p>

            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                    <code>EventEmitter</code>
            </p>

            <p class="comment">
                <h3>Implements</h3>
            </p>
            <p class="comment">
                        <code>IDeviceUpgrader</code>
            </p>


            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#bootTimeout" >bootTimeout</a>
                            </li>
                            <li>
                                <a href="#className" >className</a>
                            </li>
                            <li>
                                <a href="#options" >options</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#doUpgrade" >doUpgrade</a>
                            </li>
                            <li>
                                <a href="#getUpgradeMethodsAndFileNames" >getUpgradeMethodsAndFileNames</a>
                            </li>
                            <li>
                                <a href="#getVersion" >getVersion</a>
                            </li>
                            <li>
                                <a href="#getVersionState" >getVersionState</a>
                            </li>
                            <li>
                                <a href="#hasVerificationFile" >hasVerificationFile</a>
                            </li>
                            <li>
                                <a href="#init" >init</a>
                            </li>
                            <li>
                                <a href="#performUpgradeStep" >performUpgradeStep</a>
                            </li>
                            <li>
                                <a href="#registerHotPlugEvents" >registerHotPlugEvents</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#shouldUseLegacy" >shouldUseLegacy</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#start" >start</a>
                            </li>
                        </ul>
                    </td>
                </tr>





                    <tr>
                        <td class="col-md-4">
                            <h6><b>Accessors</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                    <a href="#ipBaseManager" >ipBaseManager</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(manager: IDeviceManager, sdkDeviceDiscoveryEmitter: EventEmitter, useLegacy?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="114" class="link-to-prism">src/components/upgrader/ipUpgrader.ts:114</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Creates a new instance of IpCameraUpgrader.</p>
</div>
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>manager</td>
                                                  
                                                        <td>
                                                                    <code>IDeviceManager</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <p>An instance of IDeviceManager setup for an IpBaseDevice.</p>

                                                        </td>
                                                </tr>
                                                <tr>
                                                        <td>sdkDeviceDiscoveryEmitter</td>
                                                  
                                                        <td>
                                                                    <code>EventEmitter</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <p>Event emitter object that emits ATTACH &amp; DETACH events for IP devices on the network</p>

                                                        </td>
                                                </tr>
                                                <tr>
                                                        <td>useLegacy</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            Yes
                                                    </td>
                                                    
                                                        <td>
                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-properties">
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="bootTimeout"></a>
                    <span class="name">
                        <span ><b>bootTimeout</b></span>
                        <a href="#bootTimeout"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>30 * 1000</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="81" class="link-to-prism">src/components/upgrader/ipUpgrader.ts:81</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Defines the maximum amount of time (in seconds) that the camera is allowed to use for
booting after firmware upgrade.</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="className"></a>
                    <span class="name">
                        <span ><b>className</b></span>
                        <a href="#className"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>&#x27;IpCameraUpgrader&#x27;</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="47" class="link-to-prism">src/components/upgrader/ipUpgrader.ts:47</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="options"></a>
                    <span class="name">
                        <span ><b>options</b></span>
                        <a href="#options"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>IUpgradeOpts</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="72" class="link-to-prism">src/components/upgrader/ipUpgrader.ts:72</a></div>
                        </td>
                    </tr>

            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>The upgrader options necessary to perform the firmware upgrade</p>
</div>
                </td>
            </tr>

        </tbody>
    </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="doUpgrade"></a>
                    <span class="name">
                        <span ><b>doUpgrade</b></span>
                        <a href="#doUpgrade"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>doUpgrade()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="649"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:649</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Perform the complete upgrade process asynchronously</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>{Promise<void>} Resolves when the upgrade process is completed. Rejects if upgrade failes.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUpgradeMethodsAndFileNames"></a>
                    <span class="name">
                        <span ><b>getUpgradeMethodsAndFileNames</b></span>
                        <a href="#getUpgradeMethodsAndFileNames"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getUpgradeMethodsAndFileNames()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="187"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:187</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/ClientWritableStreamEmulator.html" target="_self" >{ flash: (upgradeStepCompleteCb: any) &#x3D;&gt; any; verify: (upgradeStepCompleteCb: any) &#x3D;&gt; any; imageFileName: string; verificationDataFileName?: undefined; } | { flash: (upgradeStepCompleteCb: any) &#x3D;&gt; any; verify: (upgradeStepCompleteCb: any) &#x3D;&gt; ClientWritableStreamEmulator; imageFileName: string; verificationDataFileNa...</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getVersion"></a>
                    <span class="name">
                        <span ><b>getVersion</b></span>
                        <a href="#getVersion"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getVersion()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="460"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:460</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Helper function that fetches the firmware version string from the device.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;string&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>{Promise<string>} Resolves with the version straing when the action is completed.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getVersionState"></a>
                    <span class="name">
                        <span ><b>getVersionState</b></span>
                        <a href="#getVersionState"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getVersionState()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="435"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:435</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Helper function that fetches the version state from the device.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;number&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>{Promise<number>} Resolves with the version state when the action is completed.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="hasVerificationFile"></a>
                    <span class="name">
                        <span ><b>hasVerificationFile</b></span>
                        <a href="#hasVerificationFile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>hasVerificationFile()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="479"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:479</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="init"></a>
                    <span class="name">
                        <span ><b>init</b></span>
                        <a href="#init"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>init(opts: IUpgradeOpts)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="139"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:139</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Method for initializing the upgrade and setting up the proper callbacks and event listeners.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>opts</td>
                                    <td>
                                            <code>IUpgradeOpts</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>Options required to carry out and facilitate the upgrade process</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="performUpgradeStep"></a>
                    <span class="name">
                        <span ><b>performUpgradeStep</b></span>
                        <a href="#performUpgradeStep"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>performUpgradeStep(step: <a href="../undefineds/UpgradeSteps.html" target="_self">UpgradeSteps</a>, stepName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="507"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:507</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>A helper function that makes it possible to peform the upgrade substeps such as FLASH and COMMITT by
reading the cpio file and sending the data over to the camera using grpc streams.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>step</td>
                                    <td>
                                                <code><a href="../miscellaneous/enumerations.html#UpgradeSteps" target="_self" >UpgradeSteps</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>Represents the upgrade substep to be run on the device.</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>stepName</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>A string represnetation of the upgrade substep for debugging purposes.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;string&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>{Promise<string>} Resolve with upgrade status message when the action is completed.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="registerHotPlugEvents"></a>
                    <span class="name">
                        <span ><b>registerHotPlugEvents</b></span>
                        <a href="#registerHotPlugEvents"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>registerHotPlugEvents()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="156"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:156</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Sets up event listeners for ATTACH &amp; DETACH for when the device under upgrade
is rebooted as part of the process itself. This method helps indetify when the
booted camera comes up so that the upgrade process can continue to completion.</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="shouldUseLegacy"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>shouldUseLegacy</b></span>
                        <a href="#shouldUseLegacy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>shouldUseLegacy()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="215"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:215</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="start"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>start</b></span>
                        <a href="#start"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>start()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="227"
                            class="link-to-prism">src/components/upgrader/ipUpgrader.ts:227</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Perform the complete upgrade process synchronously</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        <p>{Promise<void>} Void function. Use <code>await</code> when calling this method.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>





            <section data-compodoc="block-accessors">
    <h3 id="accessors">
        Accessors
    </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="ipBaseManager"></a>
                        <span class="name"><b>ipBaseManager</b><a href="#ipBaseManager"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>ipBaseManager()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="107" class="link-to-prism">src/components/upgrader/ipUpgrader.ts:107</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Helper getter that typecasts the _cameraManager member into a IPBaseDevice type</p>
</div>

                                <div>
                                </div>
                                <div class="io-description">
                                    <b>Returns : </b>        <code><a href="../classes/IpBaseDevice.html" target="_self" >IpBaseDevice</a></code>

                                </div>
                        </td>
                    </tr>

            </tbody>
        </table>
</section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { EventEmitter } from &#x27;events&#x27;;
import cpio from &#x27;cpio-stream&#x27;;
import { lt } from &#x27;semver&#x27;;

import IUpgradeOpts from &#x27;@huddly/sdk-interfaces/lib/interfaces/IUpgradeOpts&#x27;;
import IDeviceUpgrader from &#x27;@huddly/sdk-interfaces/lib/interfaces/IDeviceUpgrader&#x27;;
import IDeviceManager from &#x27;@huddly/sdk-interfaces/lib/interfaces/IDeviceManager&#x27;;
import Logger from &#x27;@huddly/sdk-interfaces/lib/statics/Logger&#x27;;

import UpgradeStatus, { UpgradeStatusStep } from &#x27;./upgradeStatus&#x27;;
import AceUpgraderError from &#x27;./../../error/AceUpgraderError&#x27;;
import CameraEvents from &#x27;./../../utilitis/events&#x27;;
import * as grpc from &#x27;@grpc/grpc-js&#x27;;
import ErrorCodes from &#x27;./../../../src/error/errorCodes&#x27;;
import BufferStream from &#x27;./../../utilitis/bufferStream&#x27;;

import * as huddly from &#x27;@huddly/camera-proto/lib/api/huddly_pb&#x27;;
import { Empty } from &#x27;google-protobuf/google/protobuf/empty_pb&#x27;;
import IpBaseDevice from &#x27;../device/ipbase&#x27;;
import ClientWritableStreamEmulator from &#x27;../../utilitis/clientWritableStreamEmulator&#x27;;

const UPGRADE_STEP_TIMEOUT &#x3D; 20;
const VERIFICATION_FILE &#x3D; &#x27;verify.md5&#x27;;
const NEW_CPIO_FORMAT_SUPPORT &#x3D; &#x27;1.6.0&#x27;;

/**
 * Enum describing the different upgrade steps for L1.
 *
 * @export
 * @enum {number}
 */
export enum UpgradeSteps {
  FLASH &#x3D; 0,
  REBOOT &#x3D; 1,
  COMMIT &#x3D; 2,
}

/**
 * Controller class for instrumenting the upgrade process on Huddly IP cameras.
 *
 * @export
 * @class IpCameraUpgrader
 * @extends {EventEmitter}
 * @implements {IDeviceUpgrader}
 */
export default class IpCameraUpgrader extends EventEmitter implements IDeviceUpgrader {
  className: string &#x3D; &#x27;IpCameraUpgrader&#x27;;
  /**
   * @ignore
   * Camera manager instance for Ace
   *
   * @type {IDeviceManager}
   * @memberof IpCameraUpgrader
   */
  _cameraManager: IDeviceManager;

  /**
   * @ignore
   * Event emitter object that emits ATTACH &amp; DETACH events for Ace devices on the network
   *
   * @type {EventEmitter}
   * @memberof IpCameraUpgrader
   */
  _sdkDeviceDiscoveryEmitter: EventEmitter;

  /**
   * The upgrader options necessary to perform the firmware upgrade
   *
   * @type {IUpgradeOpts}
   * @memberof IpCameraUpgrader
   */
  options: IUpgradeOpts;

  /**
   * Defines the maximum amount of time (in seconds) that the camera is allowed to use for
   * booting after firmware upgrade.
   *
   * @type {IUpgradeOpts}
   * @memberof IpCameraUpgrader
   */
  bootTimeout: number &#x3D; 30 * 1000; // 30 seconds

  /**
   * @ignore
   * Upgrade status object used to emit upgrade progress throughout the whole upgrade process.
   *
   * @type {UpgradeStatus}
   * @memberof IpCameraUpgrader
   */
  _upgradeStatus: UpgradeStatus;

  /**
   * @ignore
   * Wheter or not to use the legacy cpio format
   *
   * @type {boolean}
   * @memberof IpCameraUpgrader
   */
  _useLegacy: boolean;

  /**
   * Helper getter that typecasts the _cameraManager member into a IPBaseDevice type
   *
   * @type {IpBaseDevice}
   * @memberof IpCameraUpgrader
   */
  get ipBaseManager(): IpBaseDevice {
    if (this._cameraManager instanceof IpBaseDevice) {
      return &lt;IpBaseDevice&gt;this._cameraManager;
    }
    throw new Error(
      &#x60;IP camera upgrader initialized with wrong camera manager! Manager is not instance of IpBaseDevice but &#x3D;&gt; ${this._cameraManager.constructor.name}&#x60;
    );
  }

  /**
   * Creates a new instance of IpCameraUpgrader.
   * @param {IDeviceManager} manager An instance of IDeviceManager setup for an IpBaseDevice.
   * @param {EventEmitter} sdkDeviceDiscoveryEmitter Event emitter object that emits ATTACH &amp; DETACH events for IP devices on the network
   * @memberof IpCameraUpgrader
   */
  constructor(
    manager: IDeviceManager,
    sdkDeviceDiscoveryEmitter: EventEmitter,
    useLegacy?: boolean
  ) {
    super();
    this._useLegacy &#x3D; useLegacy;
    this._cameraManager &#x3D; manager;
    this._sdkDeviceDiscoveryEmitter &#x3D; sdkDeviceDiscoveryEmitter;
  }

  /**
   * Method for initializing the upgrade and setting up the proper callbacks and event listeners.
   *
   * @param {IUpgradeOpts} opts Options required to carry out and facilitate the upgrade process
   * @memberof IpCameraUpgrader
   */
  init(opts: IUpgradeOpts): void {
    this.options &#x3D; opts;

    if (opts.bootTimeout) {
      this.bootTimeout &#x3D; opts.bootTimeout * 1000;
    }

    this.registerHotPlugEvents();
  }

  /**
   * Sets up event listeners for ATTACH &amp; DETACH for when the device under upgrade
   * is rebooted as part of the process itself. This method helps indetify when the
   * booted camera comes up so that the upgrade process can continue to completion.
   *
   * @memberof IpCameraUpgrader
   */
  registerHotPlugEvents(): void {
    this._sdkDeviceDiscoveryEmitter.on(CameraEvents.ATTACH, async (devManager) &#x3D;&gt; {
      if (devManager &amp;&amp; devManager instanceof IpBaseDevice) {
        const ipDeviceMng: IpBaseDevice &#x3D; &lt;IpBaseDevice&gt;devManager;
        if (ipDeviceMng.equals(this._cameraManager)) {
          this._cameraManager &#x3D; devManager;
          this.emit(&#x27;UPGRADE_REBOOT_COMPLETE&#x27;);
        }
      }
    });

    this._sdkDeviceDiscoveryEmitter.on(CameraEvents.DETACH, async (d) &#x3D;&gt; {
      if (d &amp;&amp; this.ipBaseManager.wsdDevice.serialNumber &#x3D;&#x3D;&#x3D; d.serialNumber) {
        this.ipBaseManager.closeConnection();
        this.emit(&#x27;UPGRADE_REBOOT&#x27;);
      }
    });
  }

  /**
   * @ignore
   * Helper function for emitting upgrade progress events
   *
   * @param {string} [statusString] A message accompanying the progress event
   * @memberof IpCameraUpgrader
   */
  emitProgressStatus(statusString?: string) {
    if (statusString) this._upgradeStatus.statusString &#x3D; statusString;
    this.emit(CameraEvents.UPGRADE_PROGRESS, this._upgradeStatus.getStatus());
  }

  getUpgradeMethodsAndFileNames() {
    if (this._useLegacy) {
      return {
        flash: (upgradeStepCompleteCb) &#x3D;&gt;
          this.ipBaseManager.grpcClient.upgradeDevice(upgradeStepCompleteCb),
        verify: (upgradeStepCompleteCb) &#x3D;&gt;
          this.ipBaseManager.grpcClient.upgradeVerify(upgradeStepCompleteCb),
        imageFileName: &#x27;image.itb&#x27;,
      };
    }
    return {
      flash: (upgradeStepCompleteCb) &#x3D;&gt;
        this.ipBaseManager.grpcClient.upgradeImage(upgradeStepCompleteCb),
      verify: (upgradeStepCompleteCb) &#x3D;&gt; {
        const endFunction &#x3D; (data: Uint8Array | string) &#x3D;&gt; {
          const verificationRequest &#x3D; new huddly.VerificationRequest();
          verificationRequest.setFormat(huddly.VerificationFormat.MD5SUM);
          verificationRequest.setData(data);
          this.ipBaseManager.grpcClient.verifyIntegrity(verificationRequest, upgradeStepCompleteCb);
        };
        const stream: ClientWritableStreamEmulator &#x3D; new ClientWritableStreamEmulator(endFunction);
        return stream;
      },
      imageFileName: &#x27;image.img&#x27;,
      verificationDataFileName: VERIFICATION_FILE,
    };
  }

  async shouldUseLegacy() {
    return (
      !(await this.hasVerificationFile()) || lt(await this.getVersion(), NEW_CPIO_FORMAT_SUPPORT)
    );
  }

  /**
   * Perform the complete upgrade process synchronously
   *
   * @return {*}  {Promise&lt;void&gt;} Void function. Use &#x60;await&#x60; when calling this method.
   * @memberof IpCameraUpgrader
   */
  async start(): Promise&lt;void&gt; {
    const firstUploadStatusStep &#x3D; new UpgradeStatusStep(&#x27;Executing software upgrade&#x27;, 30);
    const rebootStep &#x3D; new UpgradeStatusStep(&#x27;Rebooting camera&#x27;, 60);
    const verificationStep &#x3D; new UpgradeStatusStep(&#x27;Verifying new software&#x27;, 10);

    this._upgradeStatus &#x3D; new UpgradeStatus([firstUploadStatusStep, rebootStep, verificationStep]);

    try {
      if (this._useLegacy &#x3D;&#x3D;&#x3D; undefined) {
        this._useLegacy &#x3D; await this.shouldUseLegacy();
      }
      // Check that camera is running in Normal/Verified state
      await this.verifyVersionState(huddly.VersionState.VERIFIED);
      Logger.debug(&#x27;Starting Upgrade&#x27;, this.className);
      this.emitProgressStatus(&#x27;Starting upgrade&#x27;);
      this.emit(CameraEvents.UPGRADE_START);

      firstUploadStatusStep.progress &#x3D; 50;
      this.emitProgressStatus();
      Logger.debug(&#x27;Flashing firmware ...&#x27;, this.className);
      await this.flash();
      firstUploadStatusStep.progress &#x3D; 100;
      Logger.debug(&#x27;Flash completed!&#x27;, this.className);

      rebootStep.progress &#x3D; 1;
      this.emitProgressStatus(&#x27;Rebooting camera&#x27;);
      await this.reboot();

      // Start interval for emitting upgrade progress events while camera is booting up
      const rebootUpgradeProgress &#x3D; setInterval(() &#x3D;&gt; {
        if (rebootStep.progress &gt;&#x3D; 95) {
          // Last 5% will be completed upon camera coming up after reboot
          clearInterval(rebootUpgradeProgress);
          return;
        }
        rebootStep.progress +&#x3D; 5;
        this.emitProgressStatus();
      }, 1000);

      // Timeout if the camera does not come back up after bootTimeout seconds have passed!
      const bootTimeout &#x3D; setTimeout(() &#x3D;&gt; {
        clearTimeout(bootTimeout);
        clearInterval(rebootUpgradeProgress);
        this.emit(CameraEvents.TIMEOUT, &#x27;Camera did not come back up after upgrade!&#x27;);
      }, this.bootTimeout);

      this.once(&#x27;UPGRADE_REBOOT_COMPLETE&#x27;, async () &#x3D;&gt; {
        Logger.debug(&#x27;Camera successfully booted after upgrade&#x27;, this.className);
        clearInterval(rebootUpgradeProgress);
        try {
          rebootStep.progress &#x3D; 100;
          this.emitProgressStatus();

          // Check that camera comes up in Unverified state
          await this.verifyVersionState(huddly.VersionState.UNVERIFIED);

          // Check that the camera comes up with expected version
          await this.verifyVersion();

          verificationStep.progress &#x3D; 50;
          Logger.debug(&#x27;Verifying new software&#x27;, this.className);
          this.emitProgressStatus(&#x27;Verifying new software&#x27;);
          await this.commit();

          // Check that camera comes up in Committed state
          await this.verifyVersionState(huddly.VersionState.VERIFIED);
          verificationStep.progress &#x3D; 100;

          Logger.debug(&#x27;Upgrade Completed&#x27;, this.className);
          this.emitProgressStatus(&#x27;Upgrade complete&#x27;);
          clearTimeout(bootTimeout);
          this.emit(CameraEvents.UPGRADE_COMPLETE, this._cameraManager);
        } catch (e) {
          clearTimeout(bootTimeout);
          // Upgrade fail event is already emitted
        }
      });
    } catch {
      // Exeption handling and error event emitting is done on the individual steps within the try block
      // Ignore errors here
    }
  }

  /**
   * @ignore
   *
   * Does a verification of the current version state of the camera. It does a version state fetch
   * and matches that with the one given as parameter.
   *
   * @param {number} expectedState The expected state that the camera should be in.
   * @return {*}  {Promise&lt;void&gt;} Void function. Use &#x60;await&#x60; when calling this method.
   * @memberof IpCameraUpgrader
   * @throws {AceUpgraderError} Device not running in expected state.
   */
  async verifyVersionState(expectedState: number): Promise&lt;void&gt; {
    const currentState: number &#x3D; await this.getVersionState();
    if (currentState !&#x3D;&#x3D; expectedState) {
      const currentStateStr: string &#x3D; Object.keys(huddly.VersionState).find(
        (key) &#x3D;&gt; huddly.VersionState[key] &#x3D;&#x3D;&#x3D; currentState
      );
      const expectedStateStr: string &#x3D; Object.keys(huddly.VersionState).find(
        (key) &#x3D;&gt; huddly.VersionState[key] &#x3D;&#x3D;&#x3D; expectedState
      );
      const errMsg &#x3D; &#x60;Device not running in expected state. Expected ${expectedStateStr} | Got ${currentStateStr}&#x60;;
      Logger.error(errMsg, undefined, this.className);
      this.emit(CameraEvents.UPGRADE_FAILED, errMsg);
      throw new AceUpgraderError(errMsg, ErrorCodes.UPGRADE_FAILED);
    }
  }

  /**
   * @ignore
   * Helper function for reading the version string from the provided CPIO file
   * and matching that with whatever version the camera is currently running.
   *
   * @return {*}  {Promise&lt;void&gt;} Void function. Use &#x60;await&#x60; when calling this method.
   * @memberof IpCameraUpgrader
   */
  async verifyVersion(): Promise&lt;void&gt; {
    const extract &#x3D; cpio.extract();
    const currentVersion: string &#x3D; await this.getVersion();
    const expcetedVersion: string &#x3D; await new Promise((resolve) &#x3D;&gt; {
      let expcetedVersion: string &#x3D; &#x27;N/A&#x27;;
      const readTimeout: NodeJS.Timeout &#x3D; global.setTimeout(() &#x3D;&gt; {
        Logger.warn(
          &#x27;Unable to read version string from cpio file within 1s time frame&#x27;,
          this.className
        );
        resolve(&#x27;N/A&#x27;);
      }, 1000);
      extract.on(&#x27;entry&#x27;, (header: any, stream: any, cb: any) &#x3D;&gt; {
        stream.on(&#x27;end&#x27;, () &#x3D;&gt; {
          cb();
          if (header.name &#x3D;&#x3D;&#x3D; &#x27;version&#x27;) {
            extract.emit(&#x27;finish&#x27;);
          }
        });
        if (header.name &#x3D;&#x3D; &#x27;version&#x27;) {
          stream.on(&#x27;data&#x27;, (verionStr: any) &#x3D;&gt; {
            expcetedVersion &#x3D; verionStr;
          });
        }
        stream.resume();
      });
      extract.on(&#x27;finish&#x27;, () &#x3D;&gt; {
        extract.destroy();
        clearTimeout(readTimeout);
        resolve(expcetedVersion);
      });

      new BufferStream(this.options.file).pipe(extract);
    });

    if (currentVersion.toString() !&#x3D; expcetedVersion.toString()) {
      const errMsg: string &#x3D; &#x60;Camera running wrong version! Expected ${expcetedVersion} but got ${currentVersion}&#x60;;
      this.emit(CameraEvents.UPGRADE_FAILED, errMsg);
      Logger.error(errMsg, undefined, this.className);
      throw new AceUpgraderError(errMsg, ErrorCodes.UPGRADE_VERSION_MISMATCH);
    }
  }

  /**
   * @ignore
   * Calculate expected slot based on current slot.
   *
   * @param {string} curretSlot Current slot that the camera has booted from.
   * @return {*}  {string} The next slot the camera will boot after upgrade.
   * @memberof IpCameraUpgrader
   */
  calculateExpectedSlot(curretSlot: string): string {
    if (![&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;].includes(curretSlot)) {
      throw new AceUpgraderError(&#x60;Unexpected slot: ${curretSlot}&#x60;, 1);
    }

    if ([&#x27;B&#x27;, &#x27;C&#x27;].includes(curretSlot)) {
      return &#x27;A&#x27;;
    }

    if (curretSlot &#x3D;&#x3D;&#x3D; &#x27;A&#x27;) {
      return &#x27;B&#x27;;
    }
  }

  /**
   * @ignore
   * Verify that the camera has booted from the expected slot after upgrade.
   *
   * @param {string} slotBeforeUpgrade The old slot that the camera started the upgrade from.
   * @return {*}  {Promise&lt;void&gt;} Void function. Use &#x60;await&#x60; when calling this method.
   * @memberof IpCameraUpgrader
   */
  async verifySlot(slotBeforeUpgrade: string): Promise&lt;void&gt; {
    const expectedSlot: string &#x3D; this.calculateExpectedSlot(slotBeforeUpgrade);
    const currentSlot: string &#x3D; await this.ipBaseManager.getSlot();
    if (expectedSlot !&#x3D;&#x3D; currentSlot) {
      const errMsg: string &#x3D; &#x60;Camera booted from wrong slot! Expected ${expectedSlot} but got ${currentSlot}&#x60;;
      this.emit(CameraEvents.UPGRADE_FAILED, errMsg);
      Logger.error(errMsg, undefined, this.className);
      throw new AceUpgraderError(errMsg, ErrorCodes.UPGRADE_WRONG_BOOT_SLOT);
    }
  }

  /**
   * Helper function that fetches the version state from the device.
   *
   * @return {*}  {Promise&lt;number&gt;} Resolves with the version state when the action is completed.
   * @memberof IpCameraUpgrader
   */
  getVersionState(): Promise&lt;number&gt; {
    return new Promise((resolve) &#x3D;&gt; {
      this.ipBaseManager.grpcClient.getDeviceVersion(
        new Empty(),
        (err: grpc.ServiceError, deviceVersion: huddly.DeviceVersion) &#x3D;&gt; {
          if (err) {
            Logger.error(
              &#x60;Unable to get device version state! Error msg: ${err.message}&#x60;,
              err.stack,
              this.className
            );
            resolve(undefined);
          }
          resolve(deviceVersion.getVersionState());
        }
      );
    });
  }

  /**
   * Helper function that fetches the firmware version string from the device.
   *
   * @return {*}  {Promise&lt;string&gt;} Resolves with the version straing when the action is completed.
   * @memberof IpCameraUpgrader
   */
  getVersion(): Promise&lt;string&gt; {
    return new Promise((resolve) &#x3D;&gt; {
      this.ipBaseManager.grpcClient.getDeviceVersion(
        new Empty(),
        (err: grpc.ServiceError, deviceVersion: huddly.DeviceVersion) &#x3D;&gt; {
          if (err) {
            Logger.error(
              &#x60;Unable to get device version! Error msg: ${err.message}&#x60;,
              err.stack,
              this.className
            );
            resolve(undefined);
          }
          resolve(deviceVersion.getVersion());
        }
      );
    });
  }

  hasVerificationFile(): Promise&lt;boolean&gt; {
    const extract &#x3D; cpio.extract();
    return new Promise((resolve) &#x3D;&gt; {
      const timeout &#x3D; setTimeout(() &#x3D;&gt; resolve(true), 500);
      extract.on(&#x27;entry&#x27;, (header, stream, callback) &#x3D;&gt; {
        if (header.name &#x3D;&#x3D;&#x3D; VERIFICATION_FILE) {
          extract.emit(&#x27;finish&#x27;);
        }
        stream.on(&#x27;end&#x27;, callback);
        stream.resume();
      });
      extract.on(&#x27;finish&#x27;, () &#x3D;&gt; {
        clearTimeout(timeout);
        resolve(false);
      });
      new BufferStream(this.options.file).pipe(extract);
    });
  }

  /**
   * A helper function that makes it possible to peform the upgrade substeps such as FLASH and COMMITT by
   * reading the cpio file and sending the data over to the camera using grpc streams.
   *
   * @param {UpgradeSteps} step Represents the upgrade substep to be run on the device.
   * @param {string} stepName A string represnetation of the upgrade substep for debugging purposes.
   * @return {*}  {Promise&lt;string&gt;} Resolve with upgrade status message when the action is completed.
   * @memberof IpCameraUpgrader
   */
  performUpgradeStep(step: UpgradeSteps, stepName: string): Promise&lt;string&gt; {
    const extract &#x3D; cpio.extract();

    return new Promise(async (resolve, reject) &#x3D;&gt; {
      const upgradeUtils &#x3D; this.getUpgradeMethodsAndFileNames();
      const readTimeout: NodeJS.Timeout &#x3D; global.setTimeout(() &#x3D;&gt; {
        const errMsg &#x3D; &#x60;Unable to perform upgrade step ${step} within given time of ${UPGRADE_STEP_TIMEOUT} seconds&#x60;;
        Logger.warn(errMsg, this.className);
        this.emit(CameraEvents.UPGRADE_FAILED, errMsg);
        reject(errMsg);
      }, UPGRADE_STEP_TIMEOUT * 1000);

      const upgradeStepCompleteCb &#x3D; (err: grpc.ServiceError, deviceStatus: huddly.DeviceStatus) &#x3D;&gt; {
        clearTimeout(readTimeout);
        if (err !&#x3D; undefined) {
          this.emit(CameraEvents.UPGRADE_FAILED, err);
          Logger.error(
            &#x60;Unable to perform ${stepName} step on device!&#x60;,
            err.message,
            this.className
          );
          reject(err.details);
          return;
        }
        resolve(
          &#x60;${stepName} step completed. Status code ${deviceStatus.getCode()}, message ${deviceStatus.getMessage()}&#x60;
        );
      };
      let stream: grpc.ClientWritableStream&lt;huddly.Chunk&gt; | ClientWritableStreamEmulator;
      let fileToRead: string &#x3D; upgradeUtils.imageFileName;
      switch (step) {
        case UpgradeSteps.FLASH:
          stream &#x3D; upgradeUtils.flash(upgradeStepCompleteCb);
          break;
        case UpgradeSteps.COMMIT:
          stream &#x3D; upgradeUtils.verify(upgradeStepCompleteCb);
          if (upgradeUtils.verificationDataFileName) {
            // New CPIO format uses a md5 file for verifying rather than the whole image file
            fileToRead &#x3D; upgradeUtils.verificationDataFileName;
          }
          break;
        default:
          const upgradeStepStr: string &#x3D; Object.keys(UpgradeSteps).find(
            (key) &#x3D;&gt; UpgradeSteps[key] &#x3D;&#x3D;&#x3D; step
          );
          clearTimeout(readTimeout);
          reject(
            new AceUpgraderError(
              &#x60;Unknown upgrade step ${upgradeStepStr}&#x60;,
              ErrorCodes.UPGRADE_FAILED
            )
          );
      }
      extract.on(&#x27;entry&#x27;, (header: any, cpioStream: any, cb: any) &#x3D;&gt; {
        cpioStream.on(&#x27;end&#x27;, () &#x3D;&gt; {
          cb();
          if (fileToRead &#x3D;&#x3D;&#x3D; header.name) {
            extract.destroy();
            stream.end();
          }
        });
        cpioStream.on(&#x27;data&#x27;, (chunk: Buffer) &#x3D;&gt; {
          if (fileToRead &#x3D;&#x3D;&#x3D; header.name) {
            const huddlyChunk &#x3D; new huddly.Chunk();
            huddlyChunk.setContent(chunk);
            stream.write(huddlyChunk);
          }
        });
        cpioStream.resume(); // auto drain
      });

      new BufferStream(this.options.file).pipe(extract);
    });
  }

  /**
   * @ignore
   * Performs a firmware write/flash step using the provided cpio image
   *
   * @return {*}  {Promise&lt;string&gt;} Resolves with flash status message when the action is completed.
   * @memberof IpCameraUpgrader
   */
  async flash(): Promise&lt;string&gt; {
    return this.performUpgradeStep(UpgradeSteps.FLASH, &#x27;FLASH&#x27;);
  }

  /**
   * @ignore
   * Performs a software reboot on the device.
   *
   * @return {*}  {Promise&lt;void&gt;} Void function. Use &#x60;await&#x60; when calling this method.
   * @memberof IpCameraUpgrader
   */
  reboot(): Promise&lt;void&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      Logger.debug(&#x27;Rebooting camera....&#x27;, this.className);
      this.ipBaseManager.grpcClient.reset(
        new Empty(),
        (err: grpc.ServiceError, status: huddly.DeviceStatus) &#x3D;&gt; {
          if (err || status.getCode() !&#x3D;&#x3D; huddly.StatusCode.OK) {
            this.emit(CameraEvents.UPGRADE_FAILED, err);
            Logger.error(&#x60;Reboot failed!&#x60;, err, this.className);
            if (status &#x3D;&#x3D; undefined) {
              reject(&#x60;Reboot failed! Error: code [${err.code}] Details [${err.details}]&#x60;);
            } else {
              reject(
                &#x60;Reboot failed! DeviceStatus: code [${status.getCode()}] Msg [${status.getMessage()}]&#x60;
              );
            }
            return;
          }
          this.ipBaseManager.closeConnection();
          resolve();
        }
      );
    });
  }

  /**
   * @ignore
   * Performs a firmware verification step using the provided cpio image.
   *
   * @return {*}  {Promise&lt;string&gt;} Resolves with commit status message when the action is completed.
   * @memberof IpCameraUpgrader
   */
  async commit(): Promise&lt;string&gt; {
    return this.performUpgradeStep(UpgradeSteps.COMMIT, &#x27;COMMIT&#x27;);
  }

  /**
   * @ignore
   */
  upgradeIsValid(): Promise&lt;boolean&gt; {
    throw new Error(&#x27;Method not supported!&#x27;);
  }

  /**
   * Perform the complete upgrade process asynchronously
   *
   * @return {*}  {Promise&lt;void&gt;} Resolves when the upgrade process is completed. Rejects if upgrade failes.
   * @memberof IpCameraUpgrader
   */
  doUpgrade(): Promise&lt;void&gt; {
    return new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
      this.once(CameraEvents.UPGRADE_COMPLETE, () &#x3D;&gt; resolve());
      this.once(CameraEvents.UPGRADE_FAILED, (e) &#x3D;&gt; reject(e));
      this.start();
    });
  }
}
</code></pre>
    </div>
</div>









                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'IpCameraUpgrader.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
