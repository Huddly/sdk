<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>huddly-sdk</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">huddly-sdk</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>BoxfishUpgrader</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/components/upgrader/boxfishUpgrader.ts</code>
        </p>


            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                    <code><a href="https://angular.io/api/core/EventEmitter" target="_blank" >EventEmitter</a></code>
            </p>

            <p class="comment">
                <h3>Implements</h3>
            </p>
            <p class="comment">
                        <code><a href="../interfaces/IDeviceUpgrader.html" target="_self" >IDeviceUpgrader</a></code>
            </p>


            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#_boxfishPackage">_boxfishPackage</a>
                            </li>
                            <li>
                                <a href="#_cameraManager">_cameraManager</a>
                            </li>
                            <li>
                                <a href="#_logger">_logger</a>
                            </li>
                            <li>
                                <a href="#_sdkDeviceDisoveryEmitter">_sdkDeviceDisoveryEmitter</a>
                            </li>
                            <li>
                                <a href="#bootTimeout">bootTimeout</a>
                            </li>
                            <li>
                                <a href="#locksmith">locksmith</a>
                            </li>
                            <li>
                                <a href="#options">options</a>
                            </li>
                            <li>
                                <a href="#writeBufSupport">writeBufSupport</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#allocateBuf">allocateBuf</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checksumBuf">checksumBuf</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#doFlash">doFlash</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#doUpgrade">doUpgrade</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#eraseFlash">eraseFlash</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#executeFlashCmdWaitForDoneWithStatus">executeFlashCmdWaitForDoneWithStatus</a>
                            </li>
                            <li>
                                <a href="#extractSofwareVersionFromProdInfo">extractSofwareVersionFromProdInfo</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#flashFsbl">flashFsbl</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#flashImage">flashImage</a>
                            </li>
                            <li>
                                <a href="#getBootDecision">getBootDecision</a>
                            </li>
                            <li>
                                <a href="#init">init</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#initFlash">initFlash</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#legacyWriteBuf">legacyWriteBuf</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#postUpgrade">postUpgrade</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#printBootInfo">printBootInfo</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#readFlashIntoBuf">readFlashIntoBuf</a>
                            </li>
                            <li>
                                <a href="#registerHotPlugEvents">registerHotPlugEvents</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#sendReceive">sendReceive</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#setFlashBootState">setFlashBootState</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#setRamBootSelector">setRamBootSelector</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#start">start</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#upgrade">upgrade</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#writeBuf">writeBuf</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#writeBuffProbe">writeBuffProbe</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#writeFlash">writeFlash</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(manager: <a href="../interfaces/IDeviceManager.html">IDeviceManager</a>, sdkDeviceDiscoveryEmitter: <a href="https://angular.io/api/core/EventEmitter" target="_blank">EventEmitter</a>, logger: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="20" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:20</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>manager</td>
                                                  
                                                        <td>
                                                                    <code><a href="../interfaces/IDeviceManager.html" target="_self" >IDeviceManager</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>sdkDeviceDiscoveryEmitter</td>
                                                  
                                                        <td>
                                                                    <code><a href="https://angular.io/api/core/EventEmitter" target="_blank" >EventEmitter</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>logger</td>
                                                  
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_boxfishPackage"></a>
                        <span class="name">
                            <b>
                            _boxfishPackage
                            </b>
                            <a href="#_boxfishPackage"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>_boxfishPackage:     <code><a href="../classes/BoxfishPackage.html" target="_self" >BoxfishPackage</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="../classes/BoxfishPackage.html" target="_self" >BoxfishPackage</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="16" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:16</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_cameraManager"></a>
                        <span class="name">
                            <b>
                            _cameraManager
                            </b>
                            <a href="#_cameraManager"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>_cameraManager:     <code><a href="../interfaces/IDeviceManager.html" target="_self" >IDeviceManager</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="../interfaces/IDeviceManager.html" target="_self" >IDeviceManager</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="13" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:13</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_logger"></a>
                        <span class="name">
                            <b>
                            _logger
                            </b>
                            <a href="#_logger"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>_logger:     <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="15" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:15</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_sdkDeviceDisoveryEmitter"></a>
                        <span class="name">
                            <b>
                            _sdkDeviceDisoveryEmitter
                            </b>
                            <a href="#_sdkDeviceDisoveryEmitter"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>_sdkDeviceDisoveryEmitter:     <code><a href="https://angular.io/api/core/EventEmitter" target="_blank" >EventEmitter</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://angular.io/api/core/EventEmitter" target="_blank" >EventEmitter</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="14" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:14</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="bootTimeout"></a>
                        <span class="name">
                            <b>
                            bootTimeout
                            </b>
                            <a href="#bootTimeout"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>bootTimeout:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>(30 * 1000)</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:19</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="locksmith"></a>
                        <span class="name">
                            <b>
                            locksmith
                            </b>
                            <a href="#locksmith"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>locksmith:     <code><a href="../classes/Locksmith.html" target="_self" >Locksmith</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="../classes/Locksmith.html" target="_self" >Locksmith</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="17" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:17</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="options"></a>
                        <span class="name">
                            <b>
                            options
                            </b>
                            <a href="#options"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>options:     <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>{}</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="18" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:18</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="writeBufSupport"></a>
                        <span class="name">
                            <b>
                            writeBufSupport
                            </b>
                            <a href="#writeBufSupport"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <code>writeBufSupport:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>undefined</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="20" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:20</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="methods">
            Methods
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="allocateBuf"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            allocateBuf
                            </b>
                            <a href="#allocateBuf"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>allocateBuf(size)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="98" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:98</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>size</td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="checksumBuf"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            checksumBuf
                            </b>
                            <a href="#checksumBuf"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>checksumBuf(size: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, offset: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, algorithm: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="164" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:164</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Default value</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>size</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                        </td>

                                                </tr>
                                                <tr>
                                                        <td>offset</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <code>0</code>
                                                        </td>

                                                </tr>
                                                <tr>
                                                        <td>algorithm</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <code>&#x27;crc32c&#x27;</code>
                                                        </td>

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="doFlash"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            doFlash
                            </b>
                            <a href="#doFlash"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>doFlash(buffer: Buffer, address: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="248" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:248</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>buffer</td>
                                                        <td>
                                                                    <code>Buffer</code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>address</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="doUpgrade"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            doUpgrade
                            </b>
                            <a href="#doUpgrade"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>doUpgrade()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="79" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:79</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="eraseFlash"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            eraseFlash
                            </b>
                            <a href="#eraseFlash"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>eraseFlash(addr: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, size: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, statusFn: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="233" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:233</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>addr</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>size</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>statusFn</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="executeFlashCmdWaitForDoneWithStatus"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            executeFlashCmdWaitForDoneWithStatus
                            </b>
                            <a href="#executeFlashCmdWaitForDoneWithStatus"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>executeFlashCmdWaitForDoneWithStatus(cmd: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, cmdData: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, addr: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, size: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, statusFn: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="204" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:204</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>cmd</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>cmdData</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>addr</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>size</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>statusFn</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="extractSofwareVersionFromProdInfo"></a>
                        <span class="name">
                            <b>
                            extractSofwareVersionFromProdInfo
                            </b>
                            <a href="#extractSofwareVersionFromProdInfo"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>extractSofwareVersionFromProdInfo(prodInfo: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="87" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:87</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>prodInfo</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="flashFsbl"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            flashFsbl
                            </b>
                            <a href="#flashFsbl"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>flashFsbl(fsblMvcmd: Buffer)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="287" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:287</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>fsblMvcmd</td>
                                                        <td>
                                                                    <code>Buffer</code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="flashImage"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            flashImage
                            </b>
                            <a href="#flashImage"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>flashImage(imageType: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, data: Buffer, location: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="310" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:310</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>imageType</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>data</td>
                                                        <td>
                                                                    <code>Buffer</code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>location</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="getBootDecision"></a>
                        <span class="name">
                            <b>
                            getBootDecision
                            </b>
                            <a href="#getBootDecision"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>getBootDecision(prodInfo: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="92" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:92</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>prodInfo</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="init"></a>
                        <span class="name">
                            <b>
                            init
                            </b>
                            <a href="#init"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>init(opts: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="30" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:30</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>opts</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="initFlash"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            initFlash
                            </b>
                            <a href="#initFlash"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>initFlash(fsblMvcmd: Buffer, boxfishPkg: <a href="../classes/BoxfishPackage.html">BoxfishPackage</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="297" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:297</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>fsblMvcmd</td>
                                                        <td>
                                                                    <code>Buffer</code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>boxfishPkg</td>
                                                        <td>
                                                                    <code><a href="../classes/BoxfishPackage.html" target="_self" >BoxfishPackage</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="legacyWriteBuf"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            legacyWriteBuf
                            </b>
                            <a href="#legacyWriteBuf"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>legacyWriteBuf(buf: Buffer, offset: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="102" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:102</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Default value</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>buf</td>
                                                        <td>
                                                                    <code>Buffer</code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                        </td>

                                                </tr>
                                                <tr>
                                                        <td>offset</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <code>0</code>
                                                        </td>

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="postUpgrade"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            postUpgrade
                            </b>
                            <a href="#postUpgrade"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>postUpgrade(upgradeSelection: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="157" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:157</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>upgradeSelection</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="printBootInfo"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            printBootInfo
                            </b>
                            <a href="#printBootInfo"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>printBootInfo()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="323" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:323</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="readFlashIntoBuf"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            readFlashIntoBuf
                            </b>
                            <a href="#readFlashIntoBuf"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>readFlashIntoBuf(addr: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, size: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, statusFn: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="243" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:243</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>addr</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>size</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>statusFn</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="registerHotPlugEvents"></a>
                        <span class="name">
                            <b>
                            registerHotPlugEvents
                            </b>
                            <a href="#registerHotPlugEvents"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
<code>registerHotPlugEvents()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="40" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:40</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="sendReceive"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            sendReceive
                            </b>
                            <a href="#sendReceive"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>sendReceive(cmd: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, options: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="149" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:149</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Default value</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>cmd</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                        </td>

                                                </tr>
                                                <tr>
                                                        <td>options</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <code>{}</code>
                                                        </td>

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="setFlashBootState"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            setFlashBootState
                            </b>
                            <a href="#setFlashBootState"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>setFlashBootState(state: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="292" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:292</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>state</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="setRamBootSelector"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            setRamBootSelector
                            </b>
                            <a href="#setRamBootSelector"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>setRamBootSelector(selector: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="318" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:318</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>selector</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="start"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            start
                            </b>
                            <a href="#start"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>start()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="57" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:57</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="upgrade"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            upgrade
                            </b>
                            <a href="#upgrade"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>upgrade()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="330" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:330</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;string&gt;</code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="writeBuf"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            writeBuf
                            </b>
                            <a href="#writeBuf"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>writeBuf(buf: Buffer, offset: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="131" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:131</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Default value</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>buf</td>
                                                        <td>
                                                                    <code>Buffer</code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                        </td>

                                                </tr>
                                                <tr>
                                                        <td>offset</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <code>0</code>
                                                        </td>

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="writeBuffProbe"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            writeBuffProbe
                            </b>
                            <a href="#writeBuffProbe"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>writeBuffProbe()</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="116" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:116</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="writeFlash"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Async</span>
                            writeFlash
                            </b>
                            <a href="#writeFlash"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                            <span class="modifier-icon icon ion-ios-reset"></span>
                        <code>writeFlash(addr: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, size: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, statusFn: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                    </td>
                </tr>


                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="238" class="link-to-prism">src/components/upgrader/boxfishUpgrader.ts:238</a></div>
                            </td>
                        </tr>


                <tr>
                    <td class="col-md-4">

                            <div class="io-description">
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>addr</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>size</td>
                                                        <td>
                                                                    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                                <tr>
                                                        <td>statusFn</td>
                                                        <td>
                                                                    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                    
                                                    <td>
                                                            No
                                                    </td>
                                                    

                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                            <div>
                            </div>
                            <div class="io-description">
                                <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                            </div>
                                <div class="io-description">
                                    
                                </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>






    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import IDeviceUpgrader from &#x27;./../../interfaces/IDeviceUpgrader&#x27;;
import { EventEmitter } from &#x27;events&#x27;;
import IDeviceManager from &#x27;./../../interfaces/iDeviceManager&#x27;;
import { BoxfishPackage, IMAGE_TYPES } from &#x27;./boxfishpkg&#x27;;
import semver from &#x27;semver&#x27;;
import Locksmith from &#x27;./../locksmith&#x27;;
import Api from &#x27;../api&#x27;;
import { calculate } from &#x27;./../../utilitis/crc32c&#x27;;
import CameraEvents from &#x27;./../../utilitis/events&#x27;;
import Boxfish from &#x27;./../device/boxfish&#x27;;

export default class BoxfishUpgrader extends EventEmitter implements IDeviceUpgrader {
  _cameraManager: IDeviceManager;
  _sdkDeviceDisoveryEmitter: EventEmitter;
  _logger: any;
  _boxfishPackage: BoxfishPackage;
  locksmith: Locksmith;
  options: any &#x3D; {};
  bootTimeout: number &#x3D; (30 * 1000); // 30 seconds
  writeBufSupport: boolean &#x3D; undefined;

  constructor(manager: IDeviceManager, sdkDeviceDiscoveryEmitter: EventEmitter, logger: any) {
    super();
    this._cameraManager &#x3D; manager;
    this._sdkDeviceDisoveryEmitter &#x3D; sdkDeviceDiscoveryEmitter;
    this._logger &#x3D; logger;
    this.locksmith &#x3D; new Locksmith();
  }

  init(opts: any): void {
    this._boxfishPackage &#x3D; new BoxfishPackage(opts.file);
    this.options.flash_fsbl &#x3D; opts.flash_fsbl;
    this.options.file &#x3D; opts.file;
    if (opts.bootTimeout) {
      this.bootTimeout &#x3D; opts.bootTimeout * 1000;
    }
    this.registerHotPlugEvents();
  }

  registerHotPlugEvents(): void {
    this._sdkDeviceDisoveryEmitter.on(CameraEvents.ATTACH, async (devManager) &#x3D;&gt; {
      if (devManager &amp;&amp; devManager instanceof Boxfish
        &amp;&amp; this._cameraManager[&#x27;serialNumber&#x27;] &#x3D;&#x3D;&#x3D; devManager[&#x27;serialNumber&#x27;]) {
        this._cameraManager &#x3D; devManager;
        this.emit(&#x27;UPGRADE_REBOOT_COMPLETE&#x27;);
      }
    });

    this._sdkDeviceDisoveryEmitter.on(CameraEvents.DETACH, async (d) &#x3D;&gt; {
      if (d &amp;&amp; this._cameraManager[&#x27;serialNumber&#x27;] &#x3D;&#x3D;&#x3D; d.serialNumber) {
        this._cameraManager.transport.close();
        this.emit(&#x27;UPGRADE_REBOOT&#x27;);
      }
    });
  }

  async start(): Promise&lt;void&gt; {
    this.emit(CameraEvents.UPGRADE_START);
    const state &#x3D; await this.upgrade();

    // Timeout if the camera does not come back up after bootTimeout seconds have passed!
    const bootTimeout &#x3D; setTimeout(() &#x3D;&gt; {
      clearTimeout(bootTimeout);
      this.emit(CameraEvents.TIMEOUT, &#x27;Camera did not come back up after upgrade!&#x27;);
    }, this.bootTimeout);

    this.once(&#x27;UPGRADE_REBOOT_COMPLETE&#x27;, async () &#x3D;&gt; {
      try {
        await this.postUpgrade(state);
        clearTimeout(bootTimeout);
        this.emit(CameraEvents.UPGRADE_COMPLETE);
      } catch (e) {
        clearTimeout(bootTimeout);
        this.emit(CameraEvents.UPGRADE_FAILED, e);
      }
    });
  }

  async doUpgrade(): Promise&lt;any&gt; {
    return new Promise(async (resolve, reject) &#x3D;&gt; {
      this.once(CameraEvents.UPGRADE_COMPLETE, () &#x3D;&gt; resolve());
      this.once(CameraEvents.UPGRADE_FAILED, (e) &#x3D;&gt; reject(e));
      this.start();
    });
  }

  extractSofwareVersionFromProdInfo(prodInfo: any): string {
    const appVer &#x3D; prodInfo.app_version;
    return appVer.replace(/\D+-/, &#x27;&#x27;);
  }

  getBootDecision(prodInfo: any): string {
    const bac &#x3D; prodInfo.bac_fsbl;
    if (!bac) return &#x27;&#x27;;
    return bac.boot_decision;
  }

  async allocateBuf(size): Promise&lt;any&gt; {
    return this.sendReceive(&#x27;upgrader/allocate&#x27;, { args: { size } });
  }

  async legacyWriteBuf(buf: Buffer, offset: number &#x3D; 0): Promise&lt;any&gt; {
    this._logger.warn(&#x27;Falling back to file transfer&#x27;);
    const sendData &#x3D; {
      size: buf.length,
      offset,
    };
    const command &#x3D; {
      send: &#x27;upgrader/write&#x27;,
      send_data: Api.encode(sendData),
      receive: &#x27;upgrader/write_reply&#x27;,
    };
    return this._cameraManager.api.asyncFileTransfer(command, buf);
  }

  async writeBuffProbe(): Promise&lt;boolean&gt; {
    try {
      await this.sendReceive(
        &#x27;upgrader/write_buf&#x27;,
        {
          args: { data: Buffer.alloc(1), offset: 0 },
          receiveEncoding: &#x27;string&#x27;
        });
      return true;
    } catch (e) {
      this._logger.warn(&#x60;Write buf not supported in this firmware! ${e}&#x60;);
      return false;
    }
  }

  async writeBuf(buf: Buffer, offset: number &#x3D; 0): Promise&lt;any&gt; {
    if (this.writeBufSupport &#x3D;&#x3D;&#x3D; undefined) {
      this.writeBufSupport &#x3D; await this.writeBuffProbe();
    }

    if (this.writeBufSupport) {
      const result &#x3D; await this.sendReceive(
        &#x27;upgrader/write_buf&#x27;,
        {
          args: { data: buf, offset },
          receiveEncoding: &#x27;messagepack&#x27;,
          timeout: 60000
        });
      return result;
    }
    return this.legacyWriteBuf(buf, offset);
  }

  async sendReceive(cmd: string, options: any &#x3D; {}): Promise&lt;any&gt; {
    const res &#x3D; await this.locksmith.executeAsyncFunction(async () &#x3D;&gt; {
      const r &#x3D; await this._cameraManager.api.sendAndReceiveWithoutLock(cmd, options);
      return r;
    });
    return res;
  }

  async postUpgrade(upgradeSelection: string): Promise&lt;boolean&gt; {
    await this.printBootInfo();
    await this.setFlashBootState(upgradeSelection);
    await this.setRamBootSelector(upgradeSelection);
    return true;
  }

  async checksumBuf(size: number, offset: number &#x3D; 0, algorithm: string &#x3D; &#x27;crc32c&#x27;): Promise&lt;any&gt; {
    const cmd &#x3D; &#x27;upgrader/checksum&#x27;;
    const cmdResult &#x3D; &#x60;${cmd}_result&#x60;;
    const doReply &#x3D; function (reply) {
      if (algorithm &#x3D;&#x3D;&#x3D; &#x27;crc32c&#x27;) {
        return reply.checksum.readUInt32LE();
      }
      return reply.checksum;
    };

    const result &#x3D; await this._cameraManager.api.withSubscribe(
      [cmdResult], () &#x3D;&gt; new Promise(async (resolve, reject) &#x3D;&gt; {
        this._cameraManager.transport.receiveMessage(cmdResult, 5000)
          .then((data) &#x3D;&gt; {
            const receivedCmd &#x3D; data.message;
            if (receivedCmd !&#x3D;&#x3D; cmdResult) {
              reject(&#x60;Received unexpected ${receivedCmd}. Expected ${cmdResult}.&#x60;);
            } else {
              const args &#x3D; Api.decode(data.payload, &#x27;messagepack&#x27;);
              const result &#x3D; doReply(args);
              resolve(result);
            }
          })
          .catch((e) &#x3D;&gt; reject(e));

        const res &#x3D; await this.sendReceive(cmd, {
          args: { size, offset, algorithm },
          receiveEncoding: &#x27;messagepack&#x27;,
        });
        if (res.error !&#x3D;&#x3D; 0) {
          throw new Error(&#x60;Failed to retrieve checksum. Error: ${res.error}. Status: ${res.string}&#x60;);
        }
        if (res.checksum !&#x3D;&#x3D; undefined) {
          const result &#x3D; doReply(res);
          resolve(result);
        }
      }));
    return result;
  }

  async executeFlashCmdWaitForDoneWithStatus(cmd: string, cmdData: any, addr: number, size: number, statusFn: any): Promise&lt;any&gt; {
    const cmds &#x3D; {
      cmd,
      done: &#x60;${cmd}_done&#x60;,
      status: &#x60;${cmd}_status&#x60;,
    };
    return this.locksmith.executeAsyncFunction(async () &#x3D;&gt; {
      await this._cameraManager.api.withSubscribe(
        [cmds.done, cmds.status], () &#x3D;&gt; new Promise(async (resolve, reject) &#x3D;&gt; {
          this._cameraManager.transport.on(cmds.done, (data) &#x3D;&gt; {
            const args &#x3D; Api.decode(data.payload, &#x27;messagepack&#x27;);
            if (args.error_count &#x3D;&#x3D;&#x3D; 0) {
              statusFn(size, size);
              this._cameraManager.transport.removeAllListeners(cmds.done);
              this._cameraManager.transport.removeAllListeners(cmds.status);
              resolve();
            } else {
              reject(&#x60;Flash command ${cmd} failed with ${args.error_count} errors&#x60;);
            }
          });
          this._cameraManager.transport.on(cmds.status, (data) &#x3D;&gt; {
            const args &#x3D; Api.decode(data.payload, &#x27;messagepack&#x27;);
            statusFn(args.offset, size);
          });
          await this._cameraManager.api.sendAndReceiveWithoutLock(cmds.cmd, { args: cmdData });
        }));
    });
  }

  async eraseFlash(addr: number, size: number, statusFn: any): Promise&lt;any&gt; {
    const cmdData &#x3D; { flash_addr: addr, size };
    return this.executeFlashCmdWaitForDoneWithStatus(&#x27;upgrader/erase_flash&#x27;, cmdData, addr, size, statusFn);
  }

  async writeFlash(addr: number, size: number, statusFn: any): Promise&lt;any&gt; {
    const cmdData &#x3D; { flash_addr: addr, size, offset: 0 };
    return this.executeFlashCmdWaitForDoneWithStatus(&#x27;upgrader/write_flash&#x27;, cmdData, addr, size, statusFn);
  }

  async readFlashIntoBuf(addr: number, size: number, statusFn: any): Promise&lt;any&gt; {
    const cmdData &#x3D; { flash_addr: addr, size, offset: 0 };
    return this.executeFlashCmdWaitForDoneWithStatus(&#x27;upgrader/read_flash&#x27;, cmdData, addr, size, statusFn);
  }

  async doFlash(buffer: Buffer, address: string): Promise&lt;any&gt; {
    let lastTime &#x3D; 0;
    let lastProgress &#x3D; Number.POSITIVE_INFINITY;
    const status &#x3D; (progress, total) &#x3D;&gt; {
      const now &#x3D; Date.now();
      if (progress &lt; lastProgress || progress &#x3D;&#x3D;&#x3D; total || now &gt; lastTime + 1) {
        this._logger.info(&#x60;Status: ${Math.ceil(100 * (progress / total))}%\r&#x60;);
        lastTime &#x3D; now;
        lastProgress &#x3D; progress;
        if (progress &#x3D;&#x3D;&#x3D; total) {
          this._logger.info(&#x27;&#x27;);
        }
      }
    };
    const addr &#x3D; parseInt(address, 16);
    this._logger.info(&#x60;Allocating buf.. ${buffer.length}&#x60;);
    await this.allocateBuf(buffer.length);
    this._logger.info(&#x27;Uploading data to camera...&#x27;);
    await this.writeBuf(buffer);
    this._logger.info(&#x27;Calculating checksum on target...&#x27;);
    const expectedCrc &#x3D; calculate(buffer);
    const crc &#x3D; await this.checksumBuf(buffer.length);
    if (expectedCrc !&#x3D;&#x3D; crc) {
      throw new Error(&#x60;Expected crc ${expectedCrc}, got crc ${crc}&#x60;);
    }
    const eraseLen &#x3D; Math.ceil(buffer.length / 4096) * 4096;
    this._logger.info(&#x60;Erasing... addr: ${addr}&#x60;);
    await this.eraseFlash(addr, eraseLen, status);
    this._logger.info(&#x27;Writing...&#x27;);
    await this.writeFlash(addr, buffer.length, status);
    this._logger.info(&#x27;Reading from flash to memory...&#x27;);
    await this.readFlashIntoBuf(addr, buffer.length, status);
    this._logger.info(&#x27;Calculating checksum...&#x27;);
    const flashCrc &#x3D; await this.checksumBuf(buffer.length);
    if (expectedCrc !&#x3D;&#x3D; flashCrc) {
      throw new Error(&#x60;Expected crc ${expectedCrc}, got crc ${flashCrc}&#x60;);
    }
  }

  async flashFsbl(fsblMvcmd: Buffer): Promise&lt;any&gt; {
    this._logger.info(&#x27;Flashing fsbl&#x27;);
    return this.doFlash(fsblMvcmd, &#x27;0x00&#x27;);
  }

  async setFlashBootState(state: string): Promise&lt;any&gt; {
    this._logger.info(&#x60;set flash boot state ${state}&#x60;);
    return this._cameraManager.api.setProductInfo({ flash_boot_state: state });
  }

  async initFlash(fsblMvcmd: Buffer, boxfishPkg: BoxfishPackage): Promise&lt;any&gt; {
    this._logger.warn(&#x27;Initializing flash&#x27;);
    await this.flashFsbl(fsblMvcmd);
    /* eslint-disable max-len */
    await this.flashImage(IMAGE_TYPES.SSBL_HEADER, boxfishPkg.getData(IMAGE_TYPES.SSBL_HEADER), &#x27;C&#x27;);
    await this.flashImage(IMAGE_TYPES.SSBL, boxfishPkg.getData(IMAGE_TYPES.SSBL), &#x27;C&#x27;);
    await this.flashImage(IMAGE_TYPES.APP_HEADER, boxfishPkg.getData(IMAGE_TYPES.APP_HEADER), &#x27;C&#x27;);
    await this.flashImage(IMAGE_TYPES.APP, boxfishPkg.getData(IMAGE_TYPES.APP), &#x27;C&#x27;);
    /* eslint-enable max-len */
    await this.setFlashBootState(&#x27;C&#x27;);
    await this.setRamBootSelector(&#x27;C&#x27;);
  }

  async flashImage(imageType: string, data: Buffer, location: string): Promise&lt;any&gt; {
    if (data.length &#x3D;&#x3D;&#x3D; 0) {
      throw new Error(&#x60;Error starting flashing of image ${IMAGE_TYPES} - could not get data from package&#x60;);
    }
    const address &#x3D; BoxfishPackage.getFlashAddress(imageType, location);
    return this.doFlash(data, address);
  }

  async setRamBootSelector(selector: string): Promise&lt;any&gt; {
    this._logger.info(&#x60;set ram boot selector ${selector}&#x60;);
    return this._cameraManager.api.setProductInfo({ bac_fsbl: { ram_boot_selector: selector } });
  }

  async printBootInfo(): Promise&lt;void&gt; {
    const prodInfo &#x3D; await this._cameraManager.api.getProductInfo();
    this._logger.info(&#x60;Current boot decision: ${prodInfo.bac_fsbl.boot_decision}&#x60;);
    this._logger.info(&#x60;Current flash boot selector: ${prodInfo.flash_boot_state}&#x60;);
    this._logger.info(&#x60;Current ram boot selector: ${prodInfo.bac_fsbl.ram_boot_selector}&#x60;);
  }

  async upgrade(): Promise&lt;string&gt; {
    try {
      const startTime &#x3D; new Date().getTime();
      const prodInfo &#x3D; await this._cameraManager.api.getProductInfo();
      const boxfishPkg &#x3D; BoxfishPackage.makeFromFile(this.options.file);
      await boxfishPkg.init();
      this.emit(CameraEvents.UPGRADE_PROGRESS);
      const currentSwVersion &#x3D; this.extractSofwareVersionFromProdInfo(prodInfo);
      if (semver.gt(currentSwVersion, &#x27;0.0.7&#x27;)) {
        await this.locksmith.executeAsyncFunction(async () &#x3D;&gt; {
          await this._cameraManager.transport.clear();
          await this._cameraManager.transport.write(&#x27;streaming/lock&#x27;);
        });
      }

      if (prodInfo.bac_fsbl &#x3D;&#x3D;&#x3D; false &amp;&amp; !this.options.flash_fsbl) {
        throw new Error(&#x27;Unable to upgrade without first stage bootloader.\n&#x27; +
          &#x27;No first stage bootloader provided&#x27;);
      } else if (prodInfo.bac_fsbl &#x3D;&#x3D;&#x3D; false &amp;&amp; this.options.flash_fsbl) {
        const fsblBuffer &#x3D; boxfishPkg.getImage(IMAGE_TYPES.FSBL);
        await this.initFlash(fsblBuffer, boxfishPkg);
        await this._cameraManager.reboot();
        return &#x27;C&#x27;;
      }
      const bootDecision &#x3D; this.getBootDecision(prodInfo);
      this._logger.info(&#x60;Current boot decision ${bootDecision}&#x60;);
      const upgradeSelection &#x3D; bootDecision &#x3D;&#x3D;&#x3D; &#x27;A&#x27; ? &#x27;B&#x27; : &#x27;A&#x27;;

      /* eslint-disable max-len */
      await this.flashImage(IMAGE_TYPES.SSBL_HEADER, boxfishPkg.getData(IMAGE_TYPES.SSBL_HEADER), upgradeSelection);
      await this.flashImage(IMAGE_TYPES.SSBL, boxfishPkg.getData(IMAGE_TYPES.SSBL), upgradeSelection);
      await this.flashImage(IMAGE_TYPES.APP_HEADER, boxfishPkg.getData(IMAGE_TYPES.APP_HEADER), upgradeSelection);
      await this.flashImage(IMAGE_TYPES.APP, boxfishPkg.getData(IMAGE_TYPES.APP), upgradeSelection);
      /* eslint-enable max-len */
      if (semver.gt(currentSwVersion, &#x27;0.0.7&#x27;)) {
        await this.locksmith.executeAsyncFunction(async () &#x3D;&gt; {
          await this._cameraManager.transport.clear();
          await this._cameraManager.transport.write(&#x27;streaming/unlock&#x27;);
        });
      }
      await this.setRamBootSelector(upgradeSelection);
      await this.printBootInfo();
      await this._cameraManager.reboot();
      await this._cameraManager.transport.close();

      const finishTime &#x3D; new Date().getTime();
      const flashTime &#x3D; (finishTime - startTime) / 1000;
      this._logger.info(&#x60;Upgrade completed in ${flashTime} seconds&#x60;);

      return upgradeSelection;
    } catch (e) {
      this._logger.error(&#x27;UPGRADE FAILED&#x27;);
      this.emit(CameraEvents.UPGRADE_FAILED, e);
      throw e;
    }
  }
}
</code></pre>
    </div>
</div>







                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'BoxfishUpgrader.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
