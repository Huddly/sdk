<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>huddly-sdk</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">huddly-sdk</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>AutozoomControl</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/components/autozoomControl.ts</code>
        </p>



            <p class="comment">
                <h3>Implements</h3>
            </p>
            <p class="comment">
                            <code><a href="../interfaces/IAutozoomControl.html" target="_self" >IAutozoomControl</a></code>
            </p>


            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#_deviceManager">_deviceManager</a>
                            </li>
                            <li>
                                <a href="#_logger">_logger</a>
                            </li>
                            <li>
                                <a href="#_options">_options</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#updateOpts">updateOpts</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(manager: <a href="../interfaces/IDeviceManager.html">IDeviceManager</a>, logger: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, options?: <a href="../interfaces/AutozoomControlOpts.html">AutozoomControlOpts</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="9" class="link-to-prism">src/components/autozoomControl.ts:9</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>manager</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/IDeviceManager.html" target="_self" >IDeviceManager</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>logger</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>options</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/AutozoomControlOpts.html" target="_self" >AutozoomControlOpts</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            Yes
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_deviceManager"></a>
                        <span class="name">
                            <b>
                            _deviceManager</b>
                            <a href="#_deviceManager"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../interfaces/IDeviceManager.html" target="_self" >IDeviceManager</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="7" class="link-to-prism">src/components/autozoomControl.ts:7</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_logger"></a>
                        <span class="name">
                            <b>
                            _logger</b>
                            <a href="#_logger"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="8" class="link-to-prism">src/components/autozoomControl.ts:8</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_options"></a>
                        <span class="name">
                            <b>
                            _options</b>
                            <a href="#_options"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../interfaces/AutozoomControlOpts.html" target="_self" >AutozoomControlOpts</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="9" class="link-to-prism">src/components/autozoomControl.ts:9</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateOpts"></a>
                    <span class="name">
                        <b>
                            updateOpts
                        </b>
                        <a href="#updateOpts"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>updateOpts(options: <a href="../interfaces/AutozoomControlOpts.html">AutozoomControlOpts</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="40"
                            class="link-to-prism">src/components/autozoomControl.ts:40</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>options</td>
                                    <td>
                                                <code><a href="../interfaces/AutozoomControlOpts.html" target="_self" >AutozoomControlOpts</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>





    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import IAutozoomControl from &#x27;../interfaces/IAutozoomControl&#x27;;
import AutozoomControlOpts from &#x27;../interfaces/IAutozoomControlOpts&#x27;;
import IDeviceManager from &#x27;../interfaces/iDeviceManager&#x27;;
import Api from &#x27;./api&#x27;;

export default class AutozoomControl implements IAutozoomControl {
  _deviceManager: IDeviceManager;
  _logger: any;
  _options: AutozoomControlOpts;

  constructor(manager: IDeviceManager, logger: any, options?: AutozoomControlOpts) {
    this._deviceManager &#x3D; manager;
    this._logger &#x3D; logger;
    this._options &#x3D; options || {
      shouldAutoFrame: true,
    };
  }

  /**
   * @ignore
   * Check &#x60;IAutozoomControl&#x60; interface for method documentation.
   * @memberof AutozoomControl
   */
  async init(): Promise&lt;any&gt; {
    if (this._options.shouldAutoFrame !&#x3D;&#x3D; undefined &amp;&amp; this._options.shouldAutoFrame !&#x3D;&#x3D; null) {
      this._logger.debug(
        &#x60;Initializing autozoom with framing config option AUTO_PTZ: ${this._options.shouldAutoFrame}&#x60;,
        &#x27;Autozoom Control&#x27;
      );
      await this.uploadFramingConfig({
        AUTO_PTZ: this._options.shouldAutoFrame,
      });
      // Autozoom status command will after boot only respond
      // when the cnn is finished attempting to load the blob.
      // waiting to the status reply will assure the detector is ready.
      await this._deviceManager.api.getAutozoomStatus(8000);
    }
  }

  updateOpts(options: AutozoomControlOpts): Promise&lt;any&gt; {
    const currentSetOpts &#x3D; this._options;
    this._options &#x3D; {
      ...currentSetOpts,
      ...options,
    };
    return this.init();
  }

  /**
   * @ignore
   * Check &#x60;IAutozoomControl&#x60; interface for method documentation.
   * @memberof AutozoomControl
   */
  async enable(idleTimeMs: number &#x3D; 2000): Promise&lt;void&gt; {
    this._logger.debug(&#x27;Enabling autozoom persistently&#x27;, &#x27;Autozoom Control&#x27;);

    await this._deviceManager.api.sendAndReceive(
      Buffer.alloc(0),
      {
        send: &#x27;autozoom/enable&#x27;,
        receive: &#x27;autozoom/enable_reply&#x27;,
      },
      idleTimeMs
    );

    /**
     * &#x60;autozoom/enable&#x60; asynchronously sets the
     * &quot;autozoom_enabled&quot; property of the camera product
     * info. It is necessary to query the isEnabled more
     * than once to have a legitimate assertion.
     */
    const promise &#x3D; new Promise(async (resolve, reject) &#x3D;&gt; {
      let retry &#x3D; 3;
      while (retry) {
        const isEnabled &#x3D; await this.isEnabled();
        if (isEnabled) {
          resolve();
          break;
        }
        retry -&#x3D; 1;
      }
      if (retry &#x3D;&#x3D;&#x3D; 0) {
        reject(new Error(&#x27;Autozoom not on after enable.&#x27;));
      }
    });

    await promise;
    this._logger.debug(&#x27;Autozoom enabled persistently&#x27;, &#x27;Autozoom Control&#x27;);
  }

  /**
   * @ignore
   * Check &#x60;IAutozoomControl&#x60; interface for method documentation.
   * @memberof AutozoomControl
   */
  async disable(idleTimeMs: number &#x3D; 2000): Promise&lt;void&gt; {
    this._logger.debug(&#x27;Disabling autozoom persistently&#x27;, &#x27;Autozoom Control&#x27;);

    await this._deviceManager.api.sendAndReceive(
      Buffer.alloc(0),
      {
        send: &#x27;autozoom/disable&#x27;,
        receive: &#x27;autozoom/disable_reply&#x27;,
      },
      idleTimeMs
    );

    /**
     * &#x60;autozoom/disable&#x60; asynchronously sets the
     * &quot;autozoom_enabled&quot; property of the camera product
     * info. It is necessary to query the isEnabled more
     * than once to have a legitimate assertion.
     */
    const promise &#x3D; new Promise(async (resolve, reject) &#x3D;&gt; {
      let retry &#x3D; 3;
      while (retry) {
        const isEnabled &#x3D; await this.isEnabled();
        if (!isEnabled) {
          resolve();
          break;
        }
        retry -&#x3D; 1;
      }
      if (retry &#x3D;&#x3D;&#x3D; 0) {
        reject(new Error(&#x27;Autozoom not off after disable.&#x27;));
      }
    });

    await promise;
    this._logger.debug(&#x27;Autozoom disabled persistently&#x27;, &#x27;Autozoom Control&#x27;);
  }

  /**
   * @ignore
   * Check &#x60;IAutozoomControl&#x60; interface for method documentation.
   * @memberof AutozoomControl
   */
  async isEnabled(): Promise&lt;Boolean&gt; {
    const prodInfo &#x3D; await this._deviceManager.api.getProductInfo();
    return prodInfo.autozoom_enabled;
  }

  /**
   * @ignore
   * Check &#x60;IAutozoomControl&#x60; interface for method documentation.
   * @memberof AutozoomControl
   */
  async start(): Promise&lt;void&gt; {
    if (!(await this.isRunning())) {
      // Only start if not already started
      this._logger.debug(&#x27;Starting Autozoom&#x27;, &#x27;Autozoom Control&#x27;);
      await this._deviceManager.api.sendAndReceive(
        Buffer.alloc(0),
        {
          send: &#x27;autozoom/start&#x27;,
          receive: &#x27;autozoom/start_reply&#x27;,
        },
        3000
      );
    }
  }

  /**
   * @ignore
   * Check &#x60;IAutozoomControl&#x60; interface for method documentation.
   * @memberof AutozoomControl
   */
  async stop(): Promise&lt;void&gt; {
    if (await this.isRunning()) {
      // Only stop if az is running
      this._logger.debug(&#x27;Stopping Autozoom&#x27;, &#x27;Autozoom Control&#x27;);
      await this._deviceManager.api.sendAndReceive(
        Buffer.alloc(0),
        {
          send: &#x27;autozoom/stop&#x27;,
          receive: &#x27;autozoom/stop_reply&#x27;,
        },
        3000
      );
    }
  }

  /**
   * @ignore
   * Check &#x60;IAutozoomControl&#x60; interface for method documentation.
   * @memberof AutozoomControl
   */
  async isRunning(): Promise&lt;Boolean&gt; {
    const status &#x3D; await this._deviceManager.api.getAutozoomStatus();
    return status[&#x27;autozoom-active&#x27;];
  }

  /**
   * @ignore
   * Uploads the detector blob to the camera.
   *
   * @param {Buffer} blobBuffer The blob buffer to be uploaded to the camera.
   * @returns {Promise&lt;void&gt;} Void Promise.
   * @memberof AutozoomControl
   */
  async uploadBlob(blobBuffer: Buffer): Promise&lt;void&gt; {
    const status &#x3D; await this._deviceManager.api.getAutozoomStatus();
    if (!status[&#x27;network-configured&#x27;]) {
      this._logger.debug(&#x27;Uploading cnn blob&#x27;, &#x27;Autozoom Control&#x27;);
      await this._deviceManager.api.sendAndReceive(
        blobBuffer,
        {
          send: &#x27;network-blob&#x27;,
          receive: &#x27;network-blob_reply&#x27;,
        },
        60000
      );
      this._logger.debug(&#x27;Cnn blob has been uploaded. Unlocking the stream!&#x27;, &#x27;Autozoom Control&#x27;);
    } else {
      this._logger.debug(&#x27;Cnn blob already configured on the camera&#x27;, &#x27;Autozoom Control&#x27;);
    }
  }

  /**
   * @ignore
   * Uploads the configuration file for the detector.
   *
   * @param {JSON} config JSON file representing the detector configuration.
   * @returns {Promise&lt;void&gt;} Void Promise.
   * @memberof AutozoomControl
   */
  async setDetectorConfig(config: JSON): Promise&lt;void&gt; {
    this._logger.debug(&#x27;Sending detector config!&#x27;, &#x27;Autozoom Control&#x27;);
    await this._deviceManager.api.sendAndReceive(
      Api.encode(config),
      {
        send: &#x27;detector/config&#x27;,
        receive: &#x27;detector/config_reply&#x27;,
      },
      6000
    );
    this._logger.debug(&#x27;Detector config sent!&#x27;, &#x27;Autozoom Control&#x27;);
  }

  /**
   * @ignore
   * Uploads the framing configuration file on the camera for using
   * new framing ruleset.
   *
   * @param {JSON} config JSON file representing the framing configuration.
   * @returns {Promise&lt;void&gt;} Void Promise.
   * @memberof AutozoomControl
   */
  async uploadFramingConfig(config: any): Promise&lt;void&gt; {
    this._logger.debug(&#x27;Uploading new framing config&#x27;, &#x27;Autozoom Control&#x27;);
    await this._deviceManager.api.sendAndReceive(
      Api.encode(config),
      {
        send: &#x27;autozoom/framer-config&#x27;,
        receive: &#x27;autozoom/framer-config_reply&#x27;,
      },
      60000
    );
    this._logger.debug(&#x27;New framing config uploaded on the camera.&#x27;, &#x27;Autozoom Control&#x27;);
  }
}
</code></pre>
    </div>
</div>



                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'AutozoomControl.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
