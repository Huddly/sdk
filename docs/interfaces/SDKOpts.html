<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>huddly-sdk</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">huddly-sdk</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  SDKOpts</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#readme" 
                class="nav-link"
                
                role="tab" id="readme-tab" data-bs-toggle="tab" data-link="readme">README</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/index.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>The SDK initialization options.</p>

            </p>


        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#emitter" 
>
                                            emitter
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#logger" 
>
                                            logger
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="emitter"></a>
                                        <span class="name "><b>emitter</b>
                                            <a href="#emitter">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>emitter:     <code>EventEmitter</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>EventEmitter</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Optional event emitter instance used to catch
SDK events!
See <code>utilitis/events</code> class for all possible events.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="logger"></a>
                                        <span class="name "><b>logger</b>
                                            <a href="#logger">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>logger:     <code>ILogger</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>ILogger</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Logger instance used to log messages from the SDK.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>

    <div class="tab-pane fade " id="readme">
        <p><h2>SDK Usage</h2>
<p>Please check the <a href="http://developer.huddly.com/index.html">Getting Started</a> guide to integrate the sdk with your awesome application.</p>
<h2>SDK Events</h2>
<p>When you create an instance of the SDK, you provide some options on the constructor:</p>
<div><pre class="line-numbers"><code class="language-javascript">const usbApi = new DeviceApiUSB();
const opts = {
  //emitter: new EventEmitter(), &lt;- this is an optional parameter
};
const sdk = new SDK(usbApi, [usbApi], opts);</code></pre></div><p>If you do not provide the <code>emitter</code> option, the SDK instance itself will act as an Event Emitter. As a result you can use the sdk instance itself to listen for the supported events. The supported events are:</p>
<table class="table table-bordered compodoc-table">
<thead>
<tr>
<th>Event</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ATTACH</td>
<td align="left">The <code>ATTACH</code> event is fired by the SDK for each Huddly camera attached on the host machine. This event will also be fired everytime you attach a new Huddly camera to the machine while the SDK instance is running. The <code>ATTACH</code> event gives you an instance of the <code>IDeviceManager</code> which can be used to communicate with the camera.</td>
</tr>
<tr>
<td>DETACH</td>
<td align="left">The <code>DETACH</code> event is fired by the SDK in case a Huddly camera is removed/detached from the host machine. The <code>DETACH</code> event gives you the <code>Serial Number</code> of the detached device.</td>
</tr>
<tr>
<td>ERROR</td>
<td align="left">The <code>ERROR</code> event is fired by the SDK when the device initialization step cannot be performed on the discovered Huddly camera. The event consists of a payload of type <code>AttachError</code> and contains the error mesage and origin of the device initialization failure</td>
</tr>
</tbody>
</table>
<p>Examples of subscribing for <code>ATTACH</code> and <code>DETACH</code> events:</p>
<div><pre class="line-numbers"><code class="language-javascript">let connected = false;
let IQManager;
sdk.on(&#39;ATTACH&#39;, (cameraManager) =&gt; {
  // Proceed with communicating with the camera
  // For example...
  if (cameraManager.productName === &quot;Huddly IQ&quot;) {
    IQManager = cameraManager;
    connected = true;
  }
});

sdk.on(&#39;DETACH&#39;, (serial) =&gt; {
  if (IQManager.serialNumber === serial) {
    // The camera you were using has been detached from the system.
    // Proceed with deinitializing the IQManager instance..
    IQManager.closeConnection()
    .then(_ =&gt; {
      IQManager = undefined;
    }).finally(_ =&gt; {
      // For example...
      connnected = false;
    });
  }
});

sdk.on(&#39;ERROR&#39;, (sdkError) =&gt; {
  if (sdkError.device &amp;&amp; sdkError.device.serialNumber == serial) {
    // SDK is unable to initialize the desired camera
    console.error(sdkError.error);
    connected = false;
  }
});</code></pre></div></p>
    </div>

    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { EventEmitter } from &#x27;events&#x27;;

import IHuddlyDeviceAPI from &#x27;@huddly/sdk-interfaces/lib/interfaces/IHuddlyDeviceAPI&#x27;;
import IHuddlyDeviceDiscoveryAPI from &#x27;@huddly/sdk-interfaces/lib/interfaces/IHuddlyDeviceDiscoveryAPI&#x27;;
import IDeviceFactory from &#x27;@huddly/sdk-interfaces/lib/interfaces/IDeviceFactory&#x27;;
import IDeviceManager from &#x27;@huddly/sdk-interfaces/lib/interfaces/IDeviceManager&#x27;;
import ILogger from &#x27;@huddly/sdk-interfaces/lib/interfaces/ILogger&#x27;;
import IHuddlyService from &#x27;@huddly/sdk-interfaces/lib/interfaces/IHuddlyService&#x27;;
import IServiceOpts from &#x27;@huddly/sdk-interfaces/lib/interfaces/IServiceOpts&#x27;;
import Logger from &#x27;@huddly/sdk-interfaces/lib/statics/Logger&#x27;;

import { createFactory } from &#x27;./components/device/factory&#x27;;
import CameraEvents from &#x27;./utilitis/events&#x27;;
import Locksmith from &#x27;./components/locksmith&#x27;;
import Api from &#x27;./components/api&#x27;;
import sourceMapSupport from &#x27;source-map-support&#x27;;
import ErrorCodes from &#x27;./error/errorCodes&#x27;;
import AllDeviceDiscovery from &#x27;./components/allDeviceDiscovery&#x27;;
import ServiceFactory from &#x27;./components/service/factory&#x27;;
import AttachError from &#x27;./error/AttachError&#x27;;
import HuddlyHex from &#x27;@huddly/sdk-interfaces/lib/enums/HuddlyHex&#x27;;

sourceMapSupport.install();

/**
 * The SDK initialization options.
 *
 * @interface SDKOpts
 */
interface SDKOpts {
  /**
   * Logger instance used to log messages from the SDK.
   *
   * @type {ILogger}
   * @memberof SDKOpts
   */
  logger?: ILogger;
  /**
   * Optional event emitter instance used to catch
   * SDK events!
   * See &#x60;utilitis/events&#x60; class for all possible events.
   *
   * @type {EventEmitter}
   * @memberof SDKOpts
   */
  emitter?: EventEmitter;

  /**
   * @ignore
   * @type {boolean}
   * @memberof SDKOpts
   */
  developmentMode?: boolean;

  /**
   * @ignore
   *
   * @type {EventEmitter}
   * @memberof SDKOpts
   */
  apiDiscoveryEmitter?: EventEmitter;

  /**
   * @ignore
   *
   * @type {string}
   * @memberof SDKOpts
   */
  serial?: string;

  /**
   * @ignore
   *
   * @returns {iDeviceFactory}
   * @memberof SDKOpts
   */
  createFactory?(): IDeviceFactory;
}

/**
 * @export
 *
 * @class HuddlySdk
 * @implements {SDK}
 */
class HuddlySdk extends EventEmitter {
  /**
   * Event Emitter instance used to fire SDK events such as
   * ATTACH and DETACH camera events. For a full list of events
   * please see &#x60;events&#x60; class.
   *
   * @type {EventEmitter}
   * @memberof HuddlySdk
   */
  emitter: EventEmitter;

  /**
   * @ignore
   *
   * @type {EventEmitter}
   * @memberof HuddlySdk
   */
  deviceDiscovery: EventEmitter;
  /**
   * @ignore
   *
   * @type {IHuddlyDeviceAPI}
   * @memberof HuddlySdk
   */
  _mainDeviceApi: IHuddlyDeviceAPI;

  /**
   * @ignore
   *
   * @type {Array&lt;IHuddlyDeviceAPI&gt;}
   * @memberof HuddlySdk
   */
  _deviceApis: Array&lt;IHuddlyDeviceAPI&gt;;

  /**
   * @ignore
   *
   * @type {IHuddlyDeviceDiscoveryAPI}
   * @memberof HuddlySdk
   */
  _deviceDiscoveryApi: IHuddlyDeviceDiscoveryAPI;

  /**
   * @ignore
   *
   * @type {any}
   * @memberof HuddlySdk
   */
  _deviceFactory;

  private locksmith: Locksmith;
  private targetSerial: string;
  private devMode: boolean;

  /**
   * Creates an instance of HuddlySdk.
   * @param {IHuddlyDeviceAPI} deviceDiscoveryApi The Huddly device-api used for discovering the device.
   * @param {Array&lt;IHuddlyDeviceAPI&gt;} [deviceApis] Optional list of device-apis used for communicating with the device.
   * By default it uses the &#x60;deviceDiscoveryApi&#x60; parameter as the device-api used for communication.
   * @param {SDKOpts} [opts] Options used for initializing the sdk. See &#x60;SDKOpts&#x60; interface.
   * @memberof HuddlySdk
   */
  constructor(
    deviceDiscoveryApi: IHuddlyDeviceDiscoveryAPI | Array&lt;IHuddlyDeviceDiscoveryAPI&gt;,
    deviceApis?: Array&lt;IHuddlyDeviceAPI&gt;,
    opts?: SDKOpts
  ) {
    super();
    if (!deviceDiscoveryApi) {
      throw new Error(&#x27;A default device api should be provided to the sdk!&#x27;);
    }

    if (Array.isArray(deviceDiscoveryApi)) {
      this._deviceDiscoveryApi &#x3D; new AllDeviceDiscovery(deviceDiscoveryApi);
    } else {
      this._deviceDiscoveryApi &#x3D; deviceDiscoveryApi;
    }

    if (!deviceApis || deviceApis.length &#x3D;&#x3D;&#x3D; 0) {
      this.mainDeviceApi &#x3D; deviceDiscoveryApi as IHuddlyDeviceAPI;
      this._deviceApis &#x3D; new Array&lt;IHuddlyDeviceAPI&gt;();
      this._deviceApis.push(this.mainDeviceApi);
    } else {
      this._mainDeviceApi &#x3D; deviceApis[0];
      this._deviceApis &#x3D; deviceApis;
    }

    this.locksmith &#x3D; new Locksmith();

    const options &#x3D; {
      ...{
        apiDiscoveryEmitter: new EventEmitter(),
        emitter: this,
        createFactory: createFactory,
      },
      ...opts,
    };

    if (options.logger) {
      Logger.setLogger(options.logger);
    }

    this.deviceDiscovery &#x3D; options.apiDiscoveryEmitter;
    this.emitter &#x3D; options.emitter;
    this.targetSerial &#x3D; options.serial;
    this._deviceFactory &#x3D; options.createFactory();
    this.devMode &#x3D; options.developmentMode;

    this.setupDeviceDiscoveryListeners();
    this._deviceDiscoveryApi.registerForHotplugEvents(this.deviceDiscovery);
  }

  /**
   * Sets up listeners for ATTACH and DETACH camera events on the
   * device discovery api.
   * Will emit instances of &#x60;IDeviceManager&#x60; when an ATTACH event occurs.
   * Will emit the device serial number when a DETACH event occurs.
   * @memberof HuddlySdk
   */
  setupDeviceDiscoveryListeners(): void {
    this.deviceDiscovery.on(CameraEvents.ATTACH, async (device) &#x3D;&gt; {
      if (device &amp;&amp; (!this.targetSerial || this.targetSerial &#x3D;&#x3D;&#x3D; device.serialNumber)) {
        await this.locksmith.executeAsyncFunction(
          () &#x3D;&gt;
            new Promise&lt;void&gt;(async (resolve) &#x3D;&gt; {
              try {
                const cameraManager: IDeviceManager &#x3D; await this._deviceFactory.getDevice(
                  device.productId,
                  this.mainDeviceApi,
                  this.deviceApis,
                  device,
                  this.emitter
                );
                await cameraManager.initialize(this.devMode);
                this.emitter.emit(CameraEvents.ATTACH, cameraManager);
                resolve();
              } catch (error) {
                const errorMsg: string &#x3D; &#x60;No transport implementation supported for ${JSON.stringify(
                  device
                )}&#x60;;
                Logger.warn(errorMsg, HuddlySdk.name);
                const eventPayload &#x3D; {
                  device,
                  error: new AttachError(errorMsg, ErrorCodes.NO_TRANSPORT),
                  stack_trace: error,
                };
                this.emitter.emit(CameraEvents.ERROR, eventPayload);
                resolve();
              }
            })
        );
      }
    });

    this.deviceDiscovery.on(CameraEvents.DETACH, async (d) &#x3D;&gt; {
      if (d !&#x3D;&#x3D; undefined &amp;&amp; (!this.targetSerial || this.targetSerial &#x3D;&#x3D;&#x3D; d)) {
        await this.locksmith.executeAsyncFunction(
          () &#x3D;&gt;
            new Promise&lt;void&gt;((resolve) &#x3D;&gt; {
              this.emitter.emit(CameraEvents.DETACH, d);
              resolve();
            })
        );
      }
    });
  }

  /**
   * Convenience function for setting the main device api
   * used for communicating with the camera.
   *
   * @memberof HuddlySdk
   */
  set mainDeviceApi(mainApi: IHuddlyDeviceAPI) {
    this._mainDeviceApi &#x3D; mainApi;
  }

  /**
   * Convenience function for getting the main device api
   * used for communicating with the camera.
   *
   * @type {IHuddlyDeviceAPI}
   * @memberof HuddlySdk
   */
  get mainDeviceApi(): IHuddlyDeviceAPI {
    return this._mainDeviceApi;
  }

  /**
   * Convenience function for setting the list of
   * device apis which the SDK uses to establish
   * communication channels with the camera.
   *
   * @memberof HuddlySdk
   */
  set deviceApis(deviceApis: Array&lt;IHuddlyDeviceAPI&gt;) {
    this._deviceApis &#x3D; deviceApis;
  }

  /**
   * Convenience function for getting the list of
   * device apis used to establish communication with
   * the camera.
   *
   * @type {Array&lt;IHuddlyDeviceAPI&gt;}
   * @memberof HuddlySdk
   */
  get deviceApis(): Array&lt;IHuddlyDeviceAPI&gt; {
    return this._deviceApis;
  }

  /**
   * Convenience function for setting the device api
   * instance used for camera discovery.
   *
   * @memberof HuddlySdk
   */
  set deviceDiscoveryApi(api: IHuddlyDeviceDiscoveryAPI) {
    this._deviceDiscoveryApi &#x3D; api;
    this.deviceDiscoveryApi.registerForHotplugEvents(this.deviceDiscovery);
  }

  /**
   * Convenience function for getting the device api
   * instance used for camera discovery.
   *
   * @type { IHuddlyDeviceDiscoveryAPI}
   * @memberof HuddlySdk
   */
  get deviceDiscoveryApi(): IHuddlyDeviceDiscoveryAPI {
    return this._deviceDiscoveryApi;
  }

  /**
   * Initializes the device discovery api which in turn will fire
   * ATTACH events for all cameras attached to the system.
   *
   * @returns {Promise&lt;any&gt;} Returns a promise which resolves for
   * successful initialization or rejects otherwise.
   * @memberof HuddlySdk
   */
  async init(): Promise&lt;any&gt; {
    await this.deviceDiscoveryApi.initialize();
  }

  /**
   * Get a huddly service implementation class instance with communication channels already established and ready
   * to start sending and receiving information to/from.
   * @param {IServiceOpts} [serviceOpts] - Service options for initializing and setting up the service communication
   * @returns A the new instance of the huddly service implementation after the setup stage has been completed
   */
  static async getService(serviceOpts: IServiceOpts &#x3D; {}): Promise&lt;IHuddlyService&gt; {
    const service: IHuddlyService &#x3D; ServiceFactory.getService(serviceOpts);
    await service.init();
    return service;
  }

  /**
   * Get connected cameras using given device apis.
   *
   * Note that device apis might cache and control against already emitted cameras,
   * so if you&#x27;re using one that already has emitted a connected camera it might not get emitted again.
   * @param discoveryApi Camera apis to use for discovery
   * @param excludeDevices Device exclusion list. Default is the Huddly poe-to-usb device
   * @returns A list of devices
   */
  static async getConnectedCameras(
    deviceApis: IHuddlyDeviceAPI[],
    excludeDevices: HuddlyHex[] &#x3D; [HuddlyHex.BASE_PID]
  ): Promise&lt;any[]&gt; {
    return Promise.all(
      deviceApis.map(async (api: any) &#x3D;&gt; {
        const cams &#x3D; await api.deviceDiscoveryManager.deviceList(false, true);
        return cams.filter((device) &#x3D;&gt; !excludeDevices.includes(device.productId));
      })
    );
  }
}

export { CameraEvents, Api };

export default HuddlySdk;
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'SDKOpts.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
